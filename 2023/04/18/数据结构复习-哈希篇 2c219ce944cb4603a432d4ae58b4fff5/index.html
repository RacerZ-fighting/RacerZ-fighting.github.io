<!DOCTYPE html><html lang="en" theme-mode="auto"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>算法提升——哈希篇 | RacerZ</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light' || window.matchMedia('(prefers-color-scheme:light)').matches) document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark' || window.matchMedia('(prefers-color-scheme:dark)').matches) document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>算法提升——哈希篇</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-04-17T16:00:00.000Z" id="date"> 2023-04-18</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-04-25T02:12:07.387Z" id="updated"> 2023-04-25</time></div></span></div></div><hr><div id="post-content"><h2 id="数据结构复习-哈希篇"><a href="#数据结构复习-哈希篇" class="headerlink" title="数据结构复习-哈希篇"></a>数据结构复习-哈希篇</h2><ul>
<li><p>HashMap 底层原理</p>
<p>  由数组和哈希函数构成，后者计算出元素的索引存在对应数组的位置中。</p>
</li>
<li><p>拉链法解决哈希冲突</p>
<p>  当计算出来的索引相同时，即出现哈希冲突，就通过维护一个链表将所有同索引的元素（K, V 对）串起来</p>
<p class='item-img' data-src='/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled.png'><img src="/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled.png" alt="Untitled"></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/design-hashmap/">leetcode-706 设计哈希映射</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHashMap</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pair</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> key;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> val;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pair</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> val)</span> &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>            <span class="hljs-built_in">this</span>.val = val;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> key;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getVal</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> val;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVal</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>            <span class="hljs-built_in">this</span>.val = val;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> LinkedList[] table;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyHashMap</span><span class="hljs-params">()</span> &#123;<br>        table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>[<span class="hljs-number">759</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; table.length; i++) &#123;<br>            table[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;Pair&gt;();<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> value)</span> &#123;<br>        LinkedList&lt;Pair&gt; p = table[hash(key)];<br>        Iterator&lt;Pair&gt; iter = p.iterator();<br>        <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>            <span class="hljs-type">Pair</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> iter.next();<br>            <span class="hljs-keyword">if</span> (entry.getKey() == key) &#123;<br>                entry.setVal(value);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br><br>        p.addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Pair</span>(key, value));<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        LinkedList&lt;Pair&gt; p = table[hash(key)];<br>        Iterator&lt;Pair&gt; iter = p.iterator();<br>        <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>            <span class="hljs-type">Pair</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> iter.next();<br>            <span class="hljs-keyword">if</span> (entry.getKey() == key) &#123;<br>                <span class="hljs-keyword">return</span> entry.getVal();<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        LinkedList&lt;Pair&gt; p = table[hash(key)];<br>        Iterator&lt;Pair&gt; iter = p.iterator();<br>        <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>            <span class="hljs-type">Pair</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> iter.next();<br>            <span class="hljs-keyword">if</span> (entry.getKey() == key) &#123;<br>                p.remove(entry);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        <span class="hljs-keyword">return</span> key % table.length;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Your MyHashMap object will be instantiated and called as such:</span><br><span class="hljs-comment"> * MyHashMap obj = new MyHashMap();</span><br><span class="hljs-comment"> * obj.put(key,value);</span><br><span class="hljs-comment"> * int param_2 = obj.get(key);</span><br><span class="hljs-comment"> * obj.remove(key);</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>线性探查法解决哈希冲突</p>
<p>  当哈希计算得到的索引已被其他元素占有时，就线性后移直至找到一个空位置插入元素（移到最后一个元素的话就重新从第一个元素开始）</p>
<p class='item-img' data-src='/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%201.png'><img src="/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%201.png" alt="Untitled"></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHashMap23</span>&lt;K, V&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;K, V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>.Entry&lt;K, V&gt; &#123;<br>        K key;<br>        V val;<br><br>        Node(K key, V val) &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>            <span class="hljs-built_in">this</span>.val = val;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> K <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> key;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> V <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> val;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> V <span class="hljs-title function_">setValue</span><span class="hljs-params">(V val)</span> &#123;<br>            <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.val;<br>            <span class="hljs-built_in">this</span>.val = val;<br>            <span class="hljs-keyword">return</span> oldVal;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 真正存储键值对的数组</span><br>    <span class="hljs-keyword">private</span> Node&lt;K, V&gt;[] table;<br>    <span class="hljs-comment">// HashMap 中的键值对个数</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br>    <span class="hljs-comment">// HashMap 的容量，即 keys 和 vals 的 length</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cap;<br>    <span class="hljs-comment">// 默认的初始化容量</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INIT_CAP</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyHashMap23</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>(INIT_CAP);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyHashMap23</span><span class="hljs-params">(<span class="hljs-type">int</span> initCapacity)</span> &#123;<br>        size = <span class="hljs-number">0</span>;<br>        cap = initCapacity;<br>        table = (Node&lt;K, V&gt;[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>[initCapacity];<br>    &#125;<br><br>    <span class="hljs-comment">/***** 增/改 *****/</span><br><br>    <span class="hljs-comment">// 添加 key -&gt; val 键值对</span><br>    <span class="hljs-comment">// 如果键 key 已存在，则将值修改为 val</span><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V val)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (size &gt;= cap / <span class="hljs-number">2</span>) &#123;<br>            resize(cap * <span class="hljs-number">2</span>);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> getNodeIndex(key);<br><br>        <span class="hljs-comment">// key 已存在，修改对应的 val</span><br>        <span class="hljs-keyword">if</span> (i != -<span class="hljs-number">1</span>) &#123;<br>            Node&lt;K, V&gt; entry = table[i];<br>            <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> entry.val;<br>            entry.val = val;<br>            <span class="hljs-keyword">return</span> oldVal;<br>        &#125;<br><br>        <span class="hljs-comment">// key 不存在，找个空位插入</span><br>        i = hash(key);<br>        <span class="hljs-keyword">while</span> (table[i] != <span class="hljs-literal">null</span>) &#123;<br>            i = (i + <span class="hljs-number">1</span>) % cap;<br>        &#125;<br>        <span class="hljs-comment">// 此时 table[i] 为一个空位</span><br>        Node&lt;K, V&gt; x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(key, val);<br>        table[i] = x;<br>        size++;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/***** 删 *****/</span><br><br>    <span class="hljs-comment">// 删除 key 和对应的 val，并返回 val</span><br>    <span class="hljs-comment">// 若 key 不存在，则返回 null</span><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> &#123;<br>	    <span class="hljs-comment">// TODO</span><br>    &#125;<br><br>    <span class="hljs-comment">/***** 查 *****/</span><br><br>    <span class="hljs-comment">// 返回 key 对应的 val</span><br>    <span class="hljs-comment">// 如果 key 不存在，则返回 null</span><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> getNodeIndex(key);<br><br>        <span class="hljs-keyword">if</span> (i == -<span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> table[i].val;<br>    &#125;<br><br>    <span class="hljs-comment">// 判断 key 是否存在 Map 中</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsKey</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> getNodeIndex(key) != -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/***** 其他工具函数 *****/</span><br><br>    <span class="hljs-keyword">public</span> List&lt;K&gt; <span class="hljs-title function_">keys</span><span class="hljs-params">()</span> &#123;<br>        LinkedList&lt;K&gt; keyList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Node&lt;K, V&gt; entry : table) &#123;<br>            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) &#123;<br>                keyList.addLast(entry.key);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> keyList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Map.Entry&lt;K, V&gt;&gt; entries() &#123;<br>        LinkedList&lt;Map.Entry&lt;K, V&gt;&gt; entryList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Node&lt;K, V&gt; entry : table) &#123;<br>            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) &#123;<br>                entryList.addLast(entry);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> entryList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span>= <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 哈希函数，将键映射到 table 的索引</span><br>    <span class="hljs-comment">// [0, table.length - 1]</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-comment">// int: 0000 0000 0000 ... 0000</span><br>        <span class="hljs-comment">//    : 0111 1111 1111 ... 1111</span><br>        <span class="hljs-keyword">return</span> (key.hashCode() &amp; <span class="hljs-number">0x7fffffff</span>) % cap;<br>    &#125;<br><br>    <span class="hljs-comment">// 对 key 进行线性探查，返回一个索引</span><br>    <span class="hljs-comment">// 若返回 -1 说明没有找到</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getNodeIndex</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-type">int</span> i;<br>        <span class="hljs-keyword">for</span> (i = hash(key); table[i] != <span class="hljs-literal">null</span>; i = (i + <span class="hljs-number">1</span>) % cap) &#123;<br>            <span class="hljs-keyword">if</span> (table[i].key.equals(key))<br>                <span class="hljs-keyword">return</span> i;<br>        &#125;<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resize</span><span class="hljs-params">(<span class="hljs-type">int</span> newCap)</span> &#123;<br>        MyHashMap23&lt;K, V&gt; newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyHashMap23</span>&lt;&gt;(newCap);<br>        <span class="hljs-keyword">for</span> (Node&lt;K, V&gt; entry : table) &#123;<br>            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) &#123;<br>                newMap.put(entry.key, entry.val);<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">this</span>.table = newMap.table;<br>        <span class="hljs-built_in">this</span>.cap = newMap.cap;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>  细节在于如何处理 <code>remove()</code> 方法，这里有两种思路：</p>
<ol>
<li><p>将删除元素置空，并且为了防止后面哈希冲突元素无法被探查的，也需要将它们一并置空并重新放入，<code>put()</code> 方法将会把他们放在正确的位置</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (size &lt; cap / <span class="hljs-number">8</span>) &#123;<br>            resize(cap / <span class="hljs-number">2</span>);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> getNodeIndex(key);<br><br>        <span class="hljs-keyword">if</span> (i == -<span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-comment">// key 不存在，不需要 remove</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 开始 remove</span><br>        <span class="hljs-type">V</span> <span class="hljs-variable">deletedVal</span> <span class="hljs-operator">=</span> table[i].val;<br>        table[i] = <span class="hljs-literal">null</span>;<br>        size--;<br>        <span class="hljs-comment">// 保持连续性</span><br>        i = (i + <span class="hljs-number">1</span>) % cap;<br>        <span class="hljs-keyword">for</span> (; table[i] != <span class="hljs-literal">null</span>; i = (i + <span class="hljs-number">1</span>) % cap) &#123;<br>            Node&lt;K, V&gt; entry = table[i];<br>            table[i] = <span class="hljs-literal">null</span>;<br>            <span class="hljs-comment">// put 里面又会加一</span><br>            size--;<br>            put(entry.key, entry.val);<br><br>        &#125;<br><br>        <span class="hljs-keyword">return</span> deletedVal;<br>    &#125;<br></code></pre></td></tr></table></figure>
<ol>
<li><p>删除结点时不置空，而是做一个特殊标记，来保证哈希冲突元素的连续性</p>
<p> 特殊标志可由如下 dummy 表示</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Node&lt;K, V&gt; DUMMY = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (size &lt; cap / <span class="hljs-number">8</span>) &#123;<br>            resize(cap / <span class="hljs-number">2</span>);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> getNodeIndex(key);<br><br>        <span class="hljs-keyword">if</span> (i == -<span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-comment">// key 不存在，不需要 remove</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 开始 remove</span><br>        <span class="hljs-type">V</span> <span class="hljs-variable">deletedVal</span> <span class="hljs-operator">=</span> tables[i].val;<br>        <span class="hljs-comment">// 直接用占位符表示删除</span><br>        tables[i] = DUMMY;<br>        size--;<br><br>        <span class="hljs-keyword">return</span> deletedVal;<br>    &#125;<br></code></pre></td></tr></table></figure>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHashMap24</span>&lt;K, V&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;K, V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>.Entry&lt;K, V&gt; &#123;<br>        K key;<br>        V val;<br><br>        Node(K key, V val) &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>            <span class="hljs-built_in">this</span>.val = val;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> K <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> key;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> V <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> val;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> V <span class="hljs-title function_">setValue</span><span class="hljs-params">(V val)</span> &#123;<br>            <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.val;<br>            <span class="hljs-built_in">this</span>.val = val;<br>            <span class="hljs-keyword">return</span> oldVal;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 被删除的 Node 的占位符</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Node&lt;K, V&gt; DUMMY = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br><br>    <span class="hljs-comment">// 真正存储键值对的数组</span><br>    <span class="hljs-keyword">private</span> Node&lt;K, V&gt;[] tables;<br>    <span class="hljs-comment">// HashMap 中的键值对个数</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br>    <span class="hljs-comment">// HashMap 的容量，即 keys 和 vals 的 length</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cap;<br>    <span class="hljs-comment">// 默认的初始化容量</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INIT_CAP</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyHashMap24</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>(INIT_CAP);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyHashMap24</span><span class="hljs-params">(<span class="hljs-type">int</span> initCapacity)</span> &#123;<br>        size = <span class="hljs-number">0</span>;<br>        cap = initCapacity;<br>        tables = (Node&lt;K, V&gt;[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>[initCapacity];<br>    &#125;<br><br>    <span class="hljs-comment">/***** 增/改 *****/</span><br><br>    <span class="hljs-comment">// 添加 key -&gt; val 键值对</span><br>    <span class="hljs-comment">// 如果键 key 已存在，则将值修改为 val</span><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V val)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (size &gt;= cap / <span class="hljs-number">2</span>) &#123;<br>            resize(cap * <span class="hljs-number">2</span>);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> getNodeIndex(key);<br>        <span class="hljs-keyword">if</span> (i != -<span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-comment">// key 已存在，修改对应的 val</span><br>            Node&lt;K, V&gt; entry = tables[i];<br>            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> entry.val;<br>                entry.val = val;<br>                <span class="hljs-keyword">return</span> oldVal;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// key 不存在，插入</span><br>        Node&lt;K, V&gt; x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(key, val);<br>        <span class="hljs-comment">// 在 table 中找一个空位或者占位符</span><br>        i = hash(key);<br>        <span class="hljs-comment">// 不仅找空的，还可以找占位符</span><br>        <span class="hljs-keyword">while</span> (tables[i] != <span class="hljs-literal">null</span> &amp;&amp; tables[i] != DUMMY) &#123;<br>            i = (i + <span class="hljs-number">1</span>) % cap;<br>        &#125;<br>        tables[i] = x;<br>        size++;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/***** 删 *****/</span><br><br>    <span class="hljs-comment">// 删除 key 和对应的 val，并返回 val</span><br>    <span class="hljs-comment">// 若 key 不存在，则返回 null</span><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (size &lt; cap / <span class="hljs-number">8</span>) &#123;<br>            resize(cap / <span class="hljs-number">2</span>);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> getNodeIndex(key);<br><br>        <span class="hljs-keyword">if</span> (i == -<span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-comment">// key 不存在，不需要 remove</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 开始 remove</span><br>        <span class="hljs-type">V</span> <span class="hljs-variable">deletedVal</span> <span class="hljs-operator">=</span> tables[i].val;<br>        <span class="hljs-comment">// 直接用占位符表示删除</span><br>        tables[i] = DUMMY;<br>        size--;<br><br>        <span class="hljs-keyword">return</span> deletedVal;<br>    &#125;<br><br>    <span class="hljs-comment">/***** 查 *****/</span><br><br>    <span class="hljs-comment">// 返回 key 对应的 val</span><br>    <span class="hljs-comment">// 如果 key 不存在，则返回 null</span><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> getNodeIndex(key);<br><br>        <span class="hljs-keyword">if</span> (i == -<span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> tables[i].val;<br>    &#125;<br><br>    <span class="hljs-comment">// 判断 key 是否存在 Map 中</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsKey</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> getNodeIndex(key);<br><br>        <span class="hljs-keyword">return</span> i != -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 对 key 进行线性探查，返回一个索引</span><br>    <span class="hljs-comment">// 根据 keys[i] 是否为 null 判断是否找到对应的 key</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getNodeIndex</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-type">int</span> i;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (i = hash(key); tables[i] != <span class="hljs-literal">null</span>; i = (i + <span class="hljs-number">1</span>) % cap) &#123;<br>            Node&lt;K, V&gt; p = tables[i];<br>            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span>遇到占位符直接跳过</span><br>            <span class="hljs-keyword">if</span> (p == DUMMY) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (p.key.equals(key)) &#123;<br>                <span class="hljs-keyword">return</span> i;<br>            &#125;<br>            step++;<br>            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 防止死循环</span><br>            <span class="hljs-keyword">if</span> (step == tables.length) &#123;<br>                resize(cap);<br>                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span>= <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;K&gt; <span class="hljs-title function_">keys</span><span class="hljs-params">()</span> &#123;<br>        LinkedList&lt;K&gt; keyList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Node&lt;K, V&gt; entry : tables) &#123;<br>            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) &#123;<br>                keyList.addLast(entry.key);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> keyList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Map.Entry&lt;K, V&gt;&gt; entries() &#123;<br>        LinkedList&lt;Map.Entry&lt;K, V&gt;&gt; entryList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Node&lt;K, V&gt; entry : tables) &#123;<br>            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) &#123;<br>                entryList.addLast(entry);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> entryList;<br>    &#125;<br><br>    <span class="hljs-comment">// 哈希函数，将键映射到 table 的索引</span><br>    <span class="hljs-comment">// [0, table.length - 1]</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-comment">// int: 0000 0000 0000 ... 0000</span><br>        <span class="hljs-comment">//    : 0111 1111 1111 ... 1111</span><br>        <span class="hljs-keyword">return</span> (key.hashCode() &amp; <span class="hljs-number">0x7fffffff</span>) % cap;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resize</span><span class="hljs-params">(<span class="hljs-type">int</span> newCap)</span> &#123;<br>        MyHashMap24&lt;K, V&gt; newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyHashMap24</span>&lt;&gt;(newCap);<br>        <span class="hljs-keyword">for</span> (Node&lt;K, V&gt; entry : tables) &#123;<br>            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span> &amp;&amp; entry != DUMMY) &#123;<br>                newMap.put(entry.key, entry.val);<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">this</span>.tables = newMap.tables;<br>        <span class="hljs-built_in">this</span>.cap = newMap.cap;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
</li>
<li><p>HashSet 底层原理</p>
<p>  底层就是 HashMap, 复用的是它的键，因为键是唯一的（哈希冲突解决）。值直接用 dummy 作占位符即可</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHashSet</span>&lt;K&gt; &#123;<br>    <span class="hljs-comment">// val 占位符</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">PRESENT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <span class="hljs-comment">// 底层 HashMap</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HashMap&lt;K, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(K k)</span> &#123;<br>        <span class="hljs-keyword">return</span> map.put(k, PRESENT) == <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(K k)</span> &#123;<br>        <span class="hljs-keyword">return</span> map.remove(k) == PRESENT;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(K k)</span> &#123;<br>        <span class="hljs-keyword">return</span> map.containsKey(k);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> map.size();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> map.isEmpty();<br>    &#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>应用</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/two-sum/">leetcode-1 两数之和</a></p>
<p>  首先，可以沿用之前双指针 + 维护索引的方法，即索引保存后数组排序，利用双指针扫描；麻烦点就在于可能出现相同的元素，这种情况 HashMap 无能为力，因此只能自己维护一个数据结构。这里的另一个思路就是直接保存值和索引映射在 HashMap 当中，边查边存，找 need = target - num。 对于两数之和肯定不会撞上。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] twoSum(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> target) &#123;<br>        HashMap&lt;Integer, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">need</span> <span class="hljs-operator">=</span> target - nums[i];<br>            <span class="hljs-keyword">if</span> (map.containsKey(need)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] &#123;map.get(need), i&#125;;<br>            &#125;<br><br>            map.put(nums[i], i);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/copy-list-with-random-pointer/">leetcode-138 复制带随机指针的链表</a></p>
<p>  这题考察点在深拷贝，可以利用 HashMap 来维护原结点和新结点的映射</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Node <span class="hljs-title function_">copyRandomList</span><span class="hljs-params">(Node head)</span> &#123;<br>        HashMap&lt;Node, Node&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> head; p != <span class="hljs-literal">null</span>; p = p.next) &#123;<br>            map.put(p, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(p.val));<br>        &#125;<br><br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> head; p != <span class="hljs-literal">null</span>; p = p.next) &#123;<br>            <span class="hljs-type">Node</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> map.get(p);<br>            <span class="hljs-keyword">if</span> (p.next != <span class="hljs-literal">null</span>) &#123;<br>                tmp.next = map.get(p.next);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (p.random != <span class="hljs-literal">null</span>) &#123;<br>                tmp.random = map.get(p.random);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> map.get(head);<br>    &#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/valid-anagram/">leetcode-242 有效的字母异位词</a></p>
<p>  作字符统计再比较即可</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAnagram</span><span class="hljs-params">(String s, String t)</span> &#123;<br>        <span class="hljs-type">int</span>[] count1 = encodes(s);<br>        <span class="hljs-type">int</span>[] count2 = encodes(t);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span>  <span class="hljs-number">0</span>; i &lt; count1.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (count1[i] != count2[i]) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] encodes(String s) &#123;<br>        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">26</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : s.toCharArray()) &#123;<br>            count[c - <span class="hljs-string">&#x27;a&#x27;</span>]++;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/group-anagrams/">leetcode-49 字母异位词分组</a></p>
<p>  这里利用 HashMap 来维护相同字符编码到字符串集合也就是字母异位词的映射，这里对于字符编码需要额外的处理，为了保证可比较，所以最后还是得转换为字符串的形式，需要计数的时候直接用 <code>char[]</code> </p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="hljs-title function_">groupAnagrams</span><span class="hljs-params">(String[] strs)</span> &#123;<br>        HashMap&lt;String, List&lt;String&gt;&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        <span class="hljs-keyword">for</span> (String str : strs) &#123;<br>            <span class="hljs-comment">// 得到每个字符串的编码值</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> encode(str);<br>            <span class="hljs-comment">// 已存在的不执行</span><br>            map.putIfAbsent(count, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;String&gt;());<br>            map.get(count).add(str);<br>        &#125;<br><br>        LinkedList&lt;List&lt;String&gt;&gt; res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (List&lt;String&gt; value : map.values()) &#123;<br>            res.addLast(value);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>    <span class="hljs-comment">// 需要做一些改造</span><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">encode</span><span class="hljs-params">(String s)</span> &#123;<br>        <span class="hljs-type">char</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">26</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : s.toCharArray()) &#123;<br>            count[c - <span class="hljs-string">&#x27;a&#x27;</span>]++;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(count);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/first-unique-character-in-a-string/">leetcode-387 字符串中的第一个唯一字符</a></p>
<p>  HashMap 维护字符计数即可，寻找第一个字符计数为 1 的索引值</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">firstUniqChar</span><span class="hljs-params">(String s)</span> &#123;<br>        <span class="hljs-type">int</span>[] count = encode(s);<br>        <span class="hljs-type">char</span>[] p = s.toCharArray();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; p.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (count[p[i] - <span class="hljs-string">&#x27;a&#x27;</span>] == <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-keyword">return</span> i;<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] encode(String s) &#123;<br>        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">26</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : s.toCharArray()) &#123;<br>            count[c - <span class="hljs-string">&#x27;a&#x27;</span>]++;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/majority-element/">leetcode-169 多数元素</a></p>
<p>  这里可以不采用 HashMap 计数的方式，因为待求众数数量是大于一半的，因此联想正负电性混合起来的现象，采用 count 去吸引出众数也就是代表正电性的元素，最终该元素一定是使得 count 大于 0 的</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">majorityElement</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>) &#123;<br>                target = nums[i];<br>                count++;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target == nums[i]) &#123;<br>                count++;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                count--;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> target;<br>    &#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-the-difference/">leetcode-389 找不同</a></p>
<ol>
<li><p>常规哈希表做法，统计字符出现次数即可</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">char</span> <span class="hljs-title function_">findTheDifference</span><span class="hljs-params">(String s, String t)</span> &#123;<br>        <span class="hljs-type">int</span>[] count1 = encode(s);<br>        <span class="hljs-type">int</span>[] count2 = encode(t);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">26</span>; i++) &#123;<br>            <span class="hljs-keyword">if</span> (count1[i] != count2[i]) &#123;<br>                <span class="hljs-keyword">return</span> (<span class="hljs-type">char</span>) (i + <span class="hljs-string">&#x27;a&#x27;</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27; &#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] encode(String s) &#123;<br>        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">26</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : s.toCharArray()) &#123;<br>            count[c - <span class="hljs-string">&#x27;a&#x27;</span>]++;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>位运算法，将两个字符串逐位异或起来，最终的结果一定是新添加的字母</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">char</span> <span class="hljs-title function_">findTheDifference</span><span class="hljs-params">(String s, String t)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : s.toCharArray()) &#123;<br>            res = res ^ c; <br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : t.toCharArray()) &#123;<br>            res = res ^ c;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> (<span class="hljs-type">char</span>) res;<br>    &#125;<br></code></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-all-duplicates-in-an-array/">leetcode-442 数组中重复的数据</a></p>
<p>  这题有个巧妙的做法，审题可以发现“长度为 <code>n</code> 的整数数组 <code>nums</code> ，其中 <code>nums</code><br>  的所有整数都在范围 <code>[1, n]</code> 内”，也就是说 nums 数组本身就可以看作是哈希表，其元素和索引存在着某种映射关系，对于出现两次的元素，其如果看作索引的话，一定会映射到相同的值上。因此可以对第一次出现的元素做个标记，在第二次检查标记</p>
<p>  <strong>PS：</strong>注意这里做标记是乘 -1，因为元素值均为正数，但是放在索引上时记得取绝对值方式负数越界</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">findDuplicates</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>        LinkedList&lt;Integer&gt; res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) &#123;<br>            <span class="hljs-keyword">if</span> (nums[Math.abs(num) - <span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">// 第一次出现</span><br>                nums[Math.abs(num) - <span class="hljs-number">1</span>] *= -<span class="hljs-number">1</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nums[Math.abs(num) - <span class="hljs-number">1</span>] &lt; <span class="hljs-number">0</span>) &#123;<br>                res.add(Math.abs(num));<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-all-numbers-disappeared-in-an-array/">leetcode-448 找到所有数组中消失的数字</a></p>
<p>  这题可以沿用上题的思路，标记所有出现过的元素（依然用 nums 自身做映射），对于没标记过的元素，就返回它的索引值 <code>i + 1</code> ，也就是未出现过的数字</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">findDisappearedNumbers</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>        LinkedList&lt;Integer&gt; res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) &#123;<br>            <span class="hljs-keyword">if</span> (nums[Math.abs(num) - <span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>) &#123;<br>                nums[Math.abs(num) - <span class="hljs-number">1</span>] *= -<span class="hljs-number">1</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (nums[i] &gt; <span class="hljs-number">0</span>) &#123;<br>                res.add(i + <span class="hljs-number">1</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>LinkedHashMap</p>
<p>  特性：可以顺序访问所有 key</p>
<p>  为什么 HashMap 无序？源于 hash 输出的随机性</p>
<ul>
<li><p>LinkedHashMap 原理</p>
<p>  多增加一个 LinkedList 来存储元素插入顺序</p>
<p class='item-img' data-src='/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%202.png'><img src="/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%202.png" alt="Untitled"></p>
<p>  这里在删除元素时就会增加时间复杂度，因为链表本身需要先遍历索引找到对应的待删除节点。如果想以 O(1) 时间删除元素，则 HashMap 应改为维护索引到节点的映射</p>
</li>
<li><p>LinkedHashMap 实现</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLinkedHashMap</span>&lt;K, V&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> HashMap&lt;K, Node&lt;K, V&gt;&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyLinkedHashMap</span><span class="hljs-params">()</span> &#123;<br>				<span class="hljs-comment">// dummy Node</span><br>        head = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>        tail = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>        head.next = tail;<br>        tail.prev = head;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> &#123;<br>        Node&lt;K, V&gt; x = map.get(key);<br>        <span class="hljs-keyword">if</span> (x != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> x.val;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V val)</span> &#123;<br>        <span class="hljs-comment">// 若为新插入的节点，则同时插入链表和 map</span><br>        <span class="hljs-keyword">if</span> (!map.containsKey(key)) &#123;<br>            <span class="hljs-comment">// 插入新的 Node</span><br>            Node&lt;K, V&gt; x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(key, val);<br>            addLastNode(x);<br>            map.put(key, x);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">// 若存在，则替换之前的 val</span><br>        Node&lt;K, V&gt; x = map.get(key);<br>        <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> x.val;<br>        x.val = val;<br><br>        <span class="hljs-keyword">return</span> oldVal;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-comment">// 若 key 本不存在，直接返回</span><br>        <span class="hljs-keyword">if</span> (!map.containsKey(key)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">// 若 key 存在，则需要在链表中也删除</span><br>        Node&lt;K,V&gt; x = map.remove(key);<br>        removeNode(x);<br>        <span class="hljs-keyword">return</span> x.val;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsKey</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">return</span> map.containsKey(key);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Iterable&lt;K&gt; <span class="hljs-title function_">keys</span><span class="hljs-params">()</span> &#123;<br>        LinkedList&lt;K&gt; keyList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Node&lt;K, V&gt; p = head.next; p != tail; p = p.next) &#123;<br>            keyList.addLast(p.key);<br>        &#125;<br>        <span class="hljs-keyword">return</span> keyList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> map.size();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> map.isEmpty();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;K, V&gt; &#123;<br>        K key;<br>        V val;<br>        Node&lt;K, V&gt; next, prev;<br><br>        Node(K key, V val) &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>            <span class="hljs-built_in">this</span>.val = val;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Node&lt;K, V&gt; head, tail;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLastNode</span><span class="hljs-params">(Node&lt;K, V&gt; x)</span> &#123;<br>        Node&lt;K, V&gt; temp = tail.prev;<br>        <span class="hljs-comment">// temp &lt;-&gt; tail</span><br>        x.next = tail;<br>        x.prev = temp;<br><br>        temp.next = x;<br>        tail.prev = x;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeNode</span><span class="hljs-params">(Node&lt;K, V&gt; x)</span> &#123;<br>        Node&lt;K, V&gt; prev = x.prev;<br>        Node&lt;K, V&gt; next = x.next;<br>        <span class="hljs-comment">// prev &lt;-&gt; x &lt;-&gt; next</span><br><br>        prev.next = next;<br>        next.prev = prev;<br><br>        x.next = x.prev = <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>ArrayHashMap</p>
<p>  特性：可在 O(1) 时间内等概率随机返回一个 key</p>
<p>  标准 HashMap 中的 table 数组是无法提供一个随机 pop 方法的，因为其中存储元素并非都是有效（如线性探查法不是顺序存储元素的）</p>
<ul>
<li><p>原理 与 ArrayList 结合</p>
<p>  与 LinkedHashMap 类似，底层 HashMap 保存 key 到数组索引的映射</p>
<p>  这里删除元素比较有意思，由于数组中间删除元素一定会设计元素的搬移，但是删除数组尾部元素就不需要，因此我们可以先将待删除元素和尾部元素作交换，然后在把它删掉，最后重新更新 HashMap 的索引映射即可</p>
<p class='item-img' data-src='/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%203.png'><img src="/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%203.png" alt="Untitled"></p>
</li>
<li><p>ArrayHashMap 实现</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyArrayHashMap</span>&lt;K, V&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;K, V&gt; &#123;<br>        K key;<br>        V val;<br><br>        Node(K key, V val) &#123;<br>            <span class="hljs-built_in">this</span>.key = key;<br>            <span class="hljs-built_in">this</span>.val = val;<br>        &#125;<br>    &#125;<br>		<span class="hljs-comment">// key =&gt; index</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HashMap&lt;K, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>		<span class="hljs-comment">// Node List</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MyArrayList&lt;Node&lt;K, V&gt;&gt; arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Random</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyArrayHashMap</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!map.containsKey(key)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">// 获取 key 在 map 中的索引</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> map.get(key);<br>        <span class="hljs-keyword">return</span> arr.get(i).val;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V val)</span> &#123;<br>        <span class="hljs-keyword">if</span> (containsKey(key)) &#123;<br>            <span class="hljs-comment">// 修改</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> map.get(key);<br>            Node&lt;K, V&gt; x = arr.get(i);<br>            <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> x.val;<br>            x.val = val;<br>            <span class="hljs-keyword">return</span> oldVal;<br>        &#125;<br><br>        <span class="hljs-comment">// 新增</span><br>        Node&lt;K, V&gt; x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(key, val);<br>        arr.addLast(x);<br>        map.put(key, arr.size() - <span class="hljs-number">1</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!map.containsKey(key)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> map.get(key);<br>        Node&lt;K, V&gt; x = arr.get(i);<br>        <span class="hljs-comment">// 1. 最后一个元素 e 和第 i 个元素 x 换位置</span><br>        Node&lt;K, V&gt; e = arr.get(arr.size() - <span class="hljs-number">1</span>);<br>        arr.set(index, e);<br>        arr.set(arr.size() - <span class="hljs-number">1</span>, x);<br><br>        <span class="hljs-comment">// 2. 修改 map 中 e.key 对应的索引</span><br>        map.put(e.key, index);<br><br>        <span class="hljs-comment">// 3. 在数组中 removeLast</span><br>        arr.removeLast();<br><br>        <span class="hljs-comment">// 4. 在 map 中 remove x.key</span><br>        map.remove(x.key);<br><br>        <span class="hljs-keyword">return</span> x.val;<br>    &#125;<br><br>    <span class="hljs-comment">// 随机弹出一个键</span><br>    <span class="hljs-keyword">public</span> K <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.size();<br>				<span class="hljs-comment">// [0, n-1]</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">randomIndex</span> <span class="hljs-operator">=</span> r.nextInt(n);<br>        <span class="hljs-keyword">return</span> arr.get(randomIndex).key;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsKey</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">return</span> map.containsKey(key);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> map.size();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> map.isEmpty();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        MyArrayHashMap&lt;Integer, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyArrayHashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>);<br>        map.put(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br><br>        System.out.println(map.get(<span class="hljs-number">2</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>LRU 缓存淘汰算法</strong></p>
<p>  其解决的问题是由于缓存容量有限，当有新内容到来时需要选择清理掉一部分内容为新的内容腾地方，LRU 采取的策略是<strong>最近使用</strong>的原则，即最久未使用的就是待清除的。</p>
<p>  💡<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/lru-cache/">leetcode-146 LRU 缓存</a></p>
<ul>
<li><p>条件分析</p>
<p>  要想满足该 <code>cache</code> 数据结构的条件，使得 <code>put</code> 和 <code>get</code> 均在 <code>O(1)</code> 的时间复杂度下运行，则有如下条件：</p>
<blockquote>
<p>1、显然 <code>cache</code> 中的元素必须有时序，以区分最近使用的和久未使用的数据，当容量满了之后要删除最久未使用的那个元素腾位置。</p>
<p>2、我们要在 <code>cache</code> 中快速找某个 <code>key</code> 是否已存在并得到对应的 <code>val</code>；</p>
<p>3、每次访问 <code>cache</code> 中的某个 <code>key</code>，需要将这个元素变为最近使用的，也就是说 <code>cache</code> 要支持在任意位置快速插入和删除元素。</p>
</blockquote>
<p>  联想之前学的可知 LinkedHashMap 满足此条件，结合 HashMap 的快速查找属性以及 LinkedList 的快速插入和删除元素的特性</p>
</li>
<li><p>代码实现</p>
<p>  这里对于 put 方法流程如下：</p>
<p class='item-img' data-src='/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%204.png'><img src="/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%204.png" alt="Untitled"></p>
<ul>
<li><p>Java Code</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> top.john.base;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LRU</span> &#123;<br>    <span class="hljs-comment">// key -&gt; Node(key, val)</span><br>    <span class="hljs-keyword">private</span> HashMap&lt;Integer, Node&gt; map;<br>    <span class="hljs-comment">// Node(k1, v1) &lt;-&gt; Node(k2, v2)...</span><br>    <span class="hljs-keyword">private</span> DoubleList cache;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cap;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LRU</span><span class="hljs-params">(<span class="hljs-type">int</span> cap)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cap = cap;<br>        map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DoubleList</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!map.containsKey(key)) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-comment">// 变成最近使用的</span><br>        makeRecently(key);<br>        <span class="hljs-keyword">return</span> map.get(key).val;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> val)</span> &#123;<br>        <span class="hljs-keyword">if</span> (map.containsKey(key)) &#123;<br>            deleteKey(key);<br>            addRecently(key, val);<br><br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (cap == cache.size()) &#123;<br>            removeRecently();<br>        &#125;<br><br>        addRecently(key, val);<br>    &#125;<br><br>    <span class="hljs-comment">// 将某个 key 变为最近使用的</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeRecently</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        <span class="hljs-type">Node</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> map.get(key);<br>        cache.remove(x);<br>        cache.addLast(x);<br>    &#125;<br><br>    <span class="hljs-comment">// 添加最近使用的元素</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addRecently</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> val)</span> &#123;<br>        <span class="hljs-type">Node</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(key, val);<br>        cache.addLast(x);<br>        map.put(key, x);<br>    &#125;<br><br>    <span class="hljs-comment">// 删除某一个 key</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteKey</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        <span class="hljs-type">Node</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> map.get(key);<br>        cache.remove(x);<br>        map.remove(key);<br>    &#125;<br><br>    <span class="hljs-comment">// 删除最久未使用的元素</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeRecently</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Node</span> <span class="hljs-variable">del</span> <span class="hljs-operator">=</span> cache.removeFirst();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">delKey</span> <span class="hljs-operator">=</span> del.key;<br>        map.remove(delKey);<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DoubleList</span> &#123;<br>    <span class="hljs-comment">// dummy</span><br>    <span class="hljs-keyword">private</span> Node head, tail;<br>    <span class="hljs-comment">// nums</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DoubleList</span><span class="hljs-params">()</span> &#123;<br>        head = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        tail = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        head.next = tail;<br>        tail.prev = head;<br>        size = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// addLast O(1)</span><br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLast</span><span class="hljs-params">(Node x)</span> &#123;<br>        x.prev = tail.prev;<br>        x.next = tail;<br>        tail.prev.next = x;<br>        tail.prev = x;<br>        size++;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Node x)</span> &#123;<br>        x.prev.next = x.next;<br>        x.next.prev = x.prev;<br>        size--;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Node <span class="hljs-title function_">removeFirst</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (head.next == tail) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-type">Node</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> head.next;<br>        remove(first);<br>        <span class="hljs-keyword">return</span> first;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> key, val;<br>    <span class="hljs-keyword">public</span> Node next, prev;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> val)</span> &#123;<br>        <span class="hljs-built_in">this</span>.key = key;<br>        <span class="hljs-built_in">this</span>.val = val;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>  底层直接用 LinkedHashMap 的实现</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cap;<br>    <span class="hljs-keyword">private</span> LinkedHashMap&lt;Integer, Integer&gt; cache;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LRUCache</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> &#123;<br>        cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();<br>        cap = capacity;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!cache.containsKey(key)) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">val</span>  <span class="hljs-operator">=</span> cache.get(key);<br>        makeRecently(key);<br>        <span class="hljs-keyword">return</span> val;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> value)</span> &#123;<br>        <span class="hljs-keyword">if</span> (cache.containsKey(key)) &#123;<br>						<span class="hljs-comment">// 直接跳整顺序并修改即可</span><br>            makeRecently(key);<br>            cache.put(key, value);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (cache.size() &gt;= cap) &#123;<br>						<span class="hljs-comment">// 找到迭代器的第一个结点，即最久未使用的元素</span><br>           <span class="hljs-type">int</span> <span class="hljs-variable">del</span>  <span class="hljs-operator">=</span> cache.keySet().iterator().next();<br>           cache.remove(del);<br>        &#125;<br><br>        cache.put(key, value);<br>    &#125;<br>		<span class="hljs-comment">// 用于调整元素在链表中的顺序</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeRecently</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> cache.get(key);<br>        cache.remove(key);<br>        cache.put(key, val);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>LFU 缓存淘汰算法</strong></p>
<p>  LFU 按照访问频率进行淘汰元素，并且如果出现频率相同多个元素，则优先淘汰最旧的数据。</p>
<p>  <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/lfu-cache/">leetcode-460 LFU 缓存</a> <strong>hard</strong></p>
<ul>
<li><p>条件分析</p>
<p>  关键需满足的条件如下：</p>
<blockquote>
<p>1、使用一个 <code>HashMap</code>存储 <code>key</code> 到 <code>val</code> 的映射，就可以快速计算 <code>get(key)</code>。<br>  2、使用一个 <code>HashMap</code> 存储 <code>key</code> 到 <code>freq</code> 的映射，就可以快速操作 <code>key</code> 对应的 <code>freq</code> 。<br>  3.1、首先，肯定是需要 <code>freq</code> 到 <code>key</code> 的映射，用来找到 <code>freq</code> 最小的 <code>key</code>。</p>
<p>3.2、将 <code>freq</code> 最小的 <code>key</code> 删除，那你就得快速得到当前所有 <code>key</code> 最小的 <code>freq</code> 是多少。想要时间复杂度 O(1) 的话，肯定不能遍历一遍去找，那就用一个变量 <code>minFreq</code> 来记录当前最小的 <code>freq</code> 吧。</p>
<p>3.3、可能有多个 <code>key</code> 拥有相同的 <code>freq</code>，所以 <strong><code>freq</code> 对 <code>key</code> 是一对多的关系</strong>，即一个 <code>freq</code> 对应一个 <code>key</code> 的列表。</p>
<p>3.4、希望 <code>freq</code> 对应的 <code>key</code> 的列表是<strong>存在时序</strong>的，便于快速查找并删除最旧的 <code>key</code>。</p>
<p>3.5、希望<strong>能够快速删除 <code>key</code> 列表中的任何一个 <code>key</code></strong>，因为如果频次为 <code>freq</code> 的某个 <code>key</code> 被访问，那么它的频次就会变成 <code>freq+1</code>，就应该从 <code>freq</code> 对应的 <code>key</code> 列表中删除，加到 <code>freq+1</code> 对应的 <code>key</code> 的列表中。</p>
</blockquote>
<p>  这里对于 <code>freq</code> 映射到的 <code>key</code> 列表，可以利用 <code>LinkedHashSet</code> 来维护，其中的链表可以帮助我们保持时序且快速删除和添加，而哈希集合可以快速查找元素</p>
</li>
<li><p>代码实现</p>
<p class='item-img' data-src='/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%205.png'><img src="/2023/04/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87%202c219ce944cb4603a432d4ae58b4fff5/Untitled%205.png" alt="Untitled"></p>
<ul>
<li><p>Java code</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> top.john.base;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.LinkedHashSet;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LFUCache</span> &#123;<br>    <span class="hljs-comment">// key =&gt; val</span><br>    HashMap&lt;Integer, Integer&gt; keyToVal;<br>    <span class="hljs-comment">// key =&gt; freq</span><br>    HashMap&lt;Integer, Integer&gt; keyToFreq;<br>    <span class="hljs-comment">// freq =&gt; keyList</span><br>    HashMap&lt;Integer, LinkedHashSet&lt;Integer&gt;&gt; freqToKeys;<br>    <span class="hljs-comment">// 记录最小的频次</span><br>    <span class="hljs-type">int</span> minFreq;<br>    <span class="hljs-comment">// 记录 LFU 缓存的最大容量</span><br>    <span class="hljs-type">int</span> cap;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LFUCache</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> &#123;<br>        keyToVal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        keyToFreq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        freqToKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        <span class="hljs-built_in">this</span>.cap = capacity;<br>        <span class="hljs-built_in">this</span>.minFreq = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        <span class="hljs-comment">// TODO</span><br>        <span class="hljs-keyword">if</span> (!keyToFreq.containsKey(key)) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> keyToVal.get(key);<br>        increaseFreq(key);<br><br>        <span class="hljs-keyword">return</span> val;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> val)</span> &#123;<br>        <span class="hljs-comment">// TODO</span><br>        <span class="hljs-keyword">if</span> (keyToVal.containsKey(key)) &#123;<br>            keyToVal.put(key, val);<br>            increaseFreq(key);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (cap &lt;= keyToVal.size()) &#123;<br>            removeMinFreqKey();<br>        &#125;<br>        keyToVal.put(key, val);<br>        keyToFreq.put(key, <span class="hljs-number">1</span>);<br>        freqToKeys.putIfAbsent(<span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;());<br>        freqToKeys.get(<span class="hljs-number">1</span>).add(key);<br>        <span class="hljs-comment">// 注意修改 minFreq</span><br>        <span class="hljs-built_in">this</span>.minFreq = <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increaseFreq</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>        <span class="hljs-comment">// TODO</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">freq</span> <span class="hljs-operator">=</span> keyToFreq.get(key);<br>        <span class="hljs-comment">// 更新 KF 表</span><br>        keyToFreq.put(key, freq + <span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// 更新 FK 表</span><br>        <span class="hljs-comment">// 1.1 删除原 freq 中的 key</span><br>        freqToKeys.get(freq).remove(key);<br>        <span class="hljs-comment">// 1.2 更新 key 到 freq + 1 中</span><br>        freqToKeys.putIfAbsent(freq + <span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;());<br>        freqToKeys.get(freq + <span class="hljs-number">1</span>).add(key);<br>        <span class="hljs-comment">// 1.3 对原 freq 的 keyList 进行维护</span><br>        <span class="hljs-keyword">if</span> (freqToKeys.get(freq).isEmpty()) &#123;<br>            freqToKeys.remove(freq);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.minFreq == freq) &#123;<br>                <span class="hljs-built_in">this</span>.minFreq++;<br>            &#125;<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeMinFreqKey</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO</span><br>        LinkedHashSet&lt;Integer&gt; keys = freqToKeys.get(<span class="hljs-built_in">this</span>.minFreq);<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">delKey</span> <span class="hljs-operator">=</span> keys.iterator().next();<br>        <span class="hljs-comment">// 从 keysList 中删除</span><br>        keys.remove(delKey);<br>        <span class="hljs-comment">// 如果 keysList 为空了，则没有对应这个 freq 的元素了</span><br>        <span class="hljs-keyword">if</span> (keys.isEmpty()) &#123;<br>            freqToKeys.remove(<span class="hljs-built_in">this</span>.minFreq);<br>            <span class="hljs-comment">// 不需要更新 minFreq 的值，这个 API 只会在 put 新的 key 时会调用</span><br>            <span class="hljs-comment">// 出现新的 key 必然会更新 minFreq</span><br>        &#125;<br>        <span class="hljs-comment">// 从 KV 表中删除</span><br>        keyToVal.remove(delKey);<br>        <span class="hljs-comment">// 从 KF 表中删除</span><br>        keyToFreq.remove(delKey);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>最大栈</strong></p>
<p>  <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-frequency-stack/">leetcode-895 最大频率栈</a> <strong>hard</strong></p>
<p>  类似前面的题目，我们仍要维护一个频率到元素的映射，并记录频率最大值</p>
<p>  这里有个细节就是当 push 一个已存在频率映射中的元素时，只修改 valToFreq 原有映射，并添加 freqToVals 一个新的映射集即可，而之前的保留。这里的区别在于即使后面 pop 元素时，其频率是会降低但不会没有，而且每次只会降低1个频率，因此之前的频率映射集仍要保留</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FreqStack</span> &#123;<br>    <span class="hljs-comment">// 记录 FreqStack 中元素的最大频率</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">maxFreq</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// 记录 FreqStack 中每个 val 对于的出现频率</span><br>    HashMap&lt;Integer, Integer&gt; valToFreq;<br>    <br>    HashMap&lt;Integer, Stack&lt;Integer&gt;&gt; freqToVals;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FreqStack</span><span class="hljs-params">()</span> &#123;<br>        valToFreq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        freqToVals = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">push</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">freq</span> <span class="hljs-operator">=</span> valToFreq.getOrDefault(val, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;<br>        valToFreq.put(val, freq);<br><br>        freqToVals.putIfAbsent(freq, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;());<br>        freqToVals.get(freq).push(val);<br><br>        <span class="hljs-built_in">this</span>.maxFreq = Math.max(<span class="hljs-built_in">this</span>.maxFreq, freq);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> &#123;<br>        Stack&lt;Integer&gt; freqs = freqToVals.get(<span class="hljs-built_in">this</span>.maxFreq);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> freqs.pop();<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> valToFreq.get(res) - <span class="hljs-number">1</span>;<br>        valToFreq.put(res, f);<br><br>        <span class="hljs-keyword">if</span> (freqs.isEmpty()) &#123;<br>            freqToVals.remove(<span class="hljs-built_in">this</span>.maxFreq);<br>            <span class="hljs-built_in">this</span>.maxFreq--;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> res;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>设计类题目</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/design-snake-game/">leettcode-353 贪吃蛇</a></p>
<p>这里利用链表来记录蛇身的每个位置，利用哈希集合来快速判断新移动位置是否会和之前的位置发生碰撞。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SnakeGame</span> &#123;<br>    <span class="hljs-comment">// 记录蛇身位置，主要找蛇头和蛇尾</span><br>    LinkedList&lt;Integer&gt; body;<br><br>    <span class="hljs-comment">// 记录蛇身位置的集合，便于快速判断</span><br>    HashSet&lt;Integer&gt; set;<br><br>    <span class="hljs-comment">// food 出现的位置序列</span><br>    LinkedList&lt;Integer&gt; food;<br>    <span class="hljs-comment">// 判断是否存活</span><br>    <span class="hljs-type">boolean</span> isAlive;<br>    <span class="hljs-comment">// 屏幕尺寸</span><br>    <span class="hljs-type">int</span> m, n;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SnakeGame</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height, <span class="hljs-type">int</span>[][] food)</span> &#123;<br>        <span class="hljs-built_in">this</span>.m = height;<br>        <span class="hljs-built_in">this</span>.n = width;<br>        <span class="hljs-built_in">this</span>.isAlive = <span class="hljs-literal">true</span>;<br><br>        <span class="hljs-built_in">this</span>.body = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-built_in">this</span>.set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>        <span class="hljs-built_in">this</span>.food = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span>[] p : food) &#123;<br>            <span class="hljs-built_in">this</span>.food.add(encode(p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>]));<br>        &#125;<br><br>        <span class="hljs-comment">// 添加蛇头起始点</span><br>        <span class="hljs-built_in">this</span>.body.addLast(encode(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));<br>        <span class="hljs-built_in">this</span>.set.add(encode(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));<br><br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">move</span><span class="hljs-params">(String direction)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!isAlive) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 拿到原蛇头的位置</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">head</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.body.getFirst();<br>        <span class="hljs-comment">// 转换成二维坐标</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> head / n, y = head % n;<br>        <span class="hljs-comment">// 新坐标</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">nx</span> <span class="hljs-operator">=</span> x, ny = y;<br>        <span class="hljs-keyword">switch</span>(direction) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;R&quot;</span>:<br>                ny++;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;D&quot;</span>:<br>                nx++;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;U&quot;</span>:<br>                nx--;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;L&quot;</span>:<br>                ny--;<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 判断越界</span><br>        <span class="hljs-keyword">if</span> (nx &lt; <span class="hljs-number">0</span> || nx == m || ny &lt; <span class="hljs-number">0</span> || ny == n ) &#123;<br>            isAlive = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 编码新坐标</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> encode(nx, ny);<br>       <br><br>        <span class="hljs-comment">// 判断吃没吃着食物</span><br>        <span class="hljs-keyword">if</span> (!food.isEmpty() &amp;&amp; food.getFirst() == code) &#123;<br>            <span class="hljs-comment">// 身长 + 1 =&gt; 尾巴不会消失</span><br>            food.removeFirst();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">tail</span> <span class="hljs-operator">=</span> body.removeLast();<br>            set.remove(tail);<br>        &#125;<br><br>         <span class="hljs-comment">// 判断吃没吃着自己，注意是在吃饭食物后判断，因为尾部会有变化</span><br>        <span class="hljs-keyword">if</span> (set.contains(code)) &#123;<br>            isAlive = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br>        <br>        <span class="hljs-comment">// 添加新头部</span><br>        body.addFirst(code);<br>        set.add(code);<br><br>        <span class="hljs-comment">// 分数等于身长 -1</span><br>        <span class="hljs-keyword">return</span> body.size() - <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 将二维坐标编码成一维</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">encode</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>        <span class="hljs-keyword">return</span> x * n + y;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Your SnakeGame object will be instantiated and called as such:</span><br><span class="hljs-comment"> * SnakeGame obj = new SnakeGame(width, height, food);</span><br><span class="hljs-comment"> * int param_1 = obj.move(direction);</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/design-twitter/">leetcode-355 设计推特</a></p>
<p>  想法：userId 和 关注+自己的id 映射；维护一个 LinkedList</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Twitter</span> &#123;<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br>        <span class="hljs-type">int</span> userId;<br>        <span class="hljs-type">int</span> tweetId;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(<span class="hljs-type">int</span> userId, <span class="hljs-type">int</span> tweetId)</span> &#123;<br>            <span class="hljs-built_in">this</span>.userId = userId;<br>            <span class="hljs-built_in">this</span>.tweetId = tweetId;<br>        &#125;<br>    &#125;<br>    LinkedList&lt;Node&gt; news;<br>    HashMap&lt;Integer, HashSet&lt;Integer&gt;&gt; userToUsers;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Twitter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.news = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-built_in">this</span>.userToUsers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postTweet</span><span class="hljs-params">(<span class="hljs-type">int</span> userId, <span class="hljs-type">int</span> tweetId)</span> &#123;<br>        <span class="hljs-type">Node</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(userId, tweetId);<br>        news.addFirst(x);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">getNewsFeed</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>        LinkedList&lt;Integer&gt; res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-type">Iterator</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> news.iterator();<br>        <span class="hljs-keyword">while</span> (count &gt; <span class="hljs-number">0</span> &amp;&amp; list.hasNext()) &#123;<br>            <span class="hljs-type">Node</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> (Node) list.next();<br>            <span class="hljs-keyword">if</span> (x.userId == userId || (<span class="hljs-built_in">this</span>.userToUsers.containsKey(userId) &amp;&amp; <br>                <span class="hljs-built_in">this</span>.userToUsers.get(userId).contains(x.userId))) &#123;<br>                res.add(x.tweetId);<br>                count--;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">follow</span><span class="hljs-params">(<span class="hljs-type">int</span> followerId, <span class="hljs-type">int</span> followeeId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userToUsers.putIfAbsent(followerId, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;());<br>        <span class="hljs-built_in">this</span>.userToUsers.get(followerId).add(followeeId);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unfollow</span><span class="hljs-params">(<span class="hljs-type">int</span> followerId, <span class="hljs-type">int</span> followeeId)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.userToUsers.containsKey(followerId)) &#123;<br>            <span class="hljs-built_in">this</span>.userToUsers.get(followerId).remove(followeeId);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>  作者提供的一个更加聪明的设计，结合了合并 k 个有序链表的算法思路，以及 OOP 思想</p>
<ul>
<li><p>Java Code</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Tweet structure</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tweet</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> time;<br>    <span class="hljs-keyword">private</span> Tweet next;<br><br>    <span class="hljs-comment">// 需要传入推文内容（id）和发文时间</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Tweet</span><span class="hljs-params">(<span class="hljs-type">int</span> id, <span class="hljs-type">int</span> time)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.time = time;<br>        <span class="hljs-built_in">this</span>.next = <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// User Structure</span><br><span class="hljs-comment">// static int timestamp = 0</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">public</span> Set&lt;Integer&gt; followed;<br>    <span class="hljs-comment">// 用户发表的推文链表头结点</span><br>    <span class="hljs-keyword">public</span> Tweet head;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>        followed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>        <span class="hljs-built_in">this</span>.id = userId;<br>        <span class="hljs-built_in">this</span>.head = <span class="hljs-literal">null</span>;<br>        <span class="hljs-comment">// 关注一下自己</span><br>        follow(id);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">follow</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>        followed.add(userId);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unfollow</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>        <span class="hljs-comment">// 不可以取关自己</span><br>        <span class="hljs-keyword">if</span> (userId != <span class="hljs-built_in">this</span>.id)<br>            followed.remove(userId);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">post</span><span class="hljs-params">(<span class="hljs-type">int</span> tweetId)</span> &#123;<br>        <span class="hljs-type">Tweet</span> <span class="hljs-variable">twt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tweet</span>(tweetId, timestamp);<br>        timestamp++;<br>        <span class="hljs-comment">// 将新建的推文插入链表头</span><br>        <span class="hljs-comment">// 越靠前的推文 time 值越大</span><br>        twt.next = head;<br>        head = twt;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Twitter</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tweet</span> &#123;...&#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;...&#125;<br><br>    <span class="hljs-comment">// 我们需要一个映射将 userId 和 User 对象对应起来</span><br>    <span class="hljs-keyword">private</span> HashMap&lt;Integer, User&gt; userMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-comment">/** user 发表一条 tweet 动态 */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postTweet</span><span class="hljs-params">(<span class="hljs-type">int</span> userId, <span class="hljs-type">int</span> tweetId)</span> &#123;<br>        <span class="hljs-comment">// 若 userId 不存在，则新建</span><br>        <span class="hljs-keyword">if</span> (!userMap.containsKey(userId))<br>            userMap.put(userId, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(userId));<br>        <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> userMap.get(userId);<br>        u.post(tweetId);<br>    &#125;<br>    <br>    <span class="hljs-comment">/** follower 关注 followee */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">follow</span><span class="hljs-params">(<span class="hljs-type">int</span> followerId, <span class="hljs-type">int</span> followeeId)</span> &#123;<br>        <span class="hljs-comment">// 若 follower 不存在，则新建</span><br>		<span class="hljs-keyword">if</span>(!userMap.containsKey(followerId))&#123;<br>			<span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(followerId);<br>			userMap.put(followerId, u);<br>		&#125;<br>        <span class="hljs-comment">// 若 followee 不存在，则新建</span><br>		<span class="hljs-keyword">if</span>(!userMap.containsKey(followeeId))&#123;<br>			<span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(followeeId);<br>			userMap.put(followeeId, u);<br>		&#125;<br>		userMap.get(followerId).follow(followeeId);<br>    &#125;<br>    <br>    <span class="hljs-comment">/** follower 取关 followee，如果 Id 不存在则什么都不做 */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unfollow</span><span class="hljs-params">(<span class="hljs-type">int</span> followerId, <span class="hljs-type">int</span> followeeId)</span> &#123;<br>        <span class="hljs-keyword">if</span> (userMap.containsKey(followerId)) &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">flwer</span> <span class="hljs-operator">=</span> userMap.get(followerId);<br>            flwer.unfollow(followeeId);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/** 返回该 user 关注的人（包括他自己）最近的动态 id，</span><br><span class="hljs-comment">    最多 10 条，而且这些动态必须按从新到旧的时间线顺序排列。*/</span><br>    <span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">getNewsFeed</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>        <span class="hljs-comment">// 合并 k 个有序链表的思路，利用优先级队列</span><br>				List&lt;Integer&gt; res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">if</span> (!userMap.containsKey(userId)) <span class="hljs-keyword">return</span> res;<br>        <span class="hljs-comment">// 关注列表的用户 Id</span><br>        Set&lt;Integer&gt; users = userMap.get(userId).followed;<br>        <span class="hljs-comment">// 自动通过 time 属性从大到小排序，容量为 users 的大小</span><br>        PriorityQueue&lt;Tweet&gt; pq = <br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(users.size(), (a, b)-&gt;(b.time - a.time));<br><br>        <span class="hljs-comment">// 先将所有链表头节点插入优先级队列</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> id : users) &#123;<br>            <span class="hljs-type">Tweet</span> <span class="hljs-variable">twt</span> <span class="hljs-operator">=</span> userMap.get(id).head;<br>							<span class="hljs-comment">// 有的零推文发送要考虑！</span><br>            <span class="hljs-keyword">if</span> (twt == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;<br>            pq.add(twt);<br>        &#125;<br><br>        <span class="hljs-keyword">while</span> (!pq.isEmpty()) &#123;<br>            <span class="hljs-comment">// 最多返回 10 条就够了</span><br>            <span class="hljs-keyword">if</span> (res.size() == <span class="hljs-number">10</span>) <span class="hljs-keyword">break</span>;<br>            <span class="hljs-comment">// 弹出 time 值最大的（最近发表的）</span><br>            <span class="hljs-type">Tweet</span> <span class="hljs-variable">twt</span> <span class="hljs-operator">=</span> pq.poll();<br>            res.add(twt.id);<br>            <span class="hljs-comment">// 将下一篇 Tweet 插入进行排序</span><br>            <span class="hljs-keyword">if</span> (twt.next != <span class="hljs-literal">null</span>) <br>                pq.add(twt.next);<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/design-phone-directory/">leetcode-379 电话目录管理系统</a></p>
<p>  哈希集合存储已分配的号码方便快速查询；链表来存储未分配号码，先入先出</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneDirectory</span> &#123;<br>    HashSet&lt;Integer&gt; finished;<br>    LinkedList&lt;Integer&gt; unfinished;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PhoneDirectory</span><span class="hljs-params">(<span class="hljs-type">int</span> maxNumbers)</span> &#123;<br>        <span class="hljs-built_in">this</span>.finished = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>        <span class="hljs-built_in">this</span>.unfinished = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; maxNumbers; i ++) &#123;<br>            <span class="hljs-built_in">this</span>.unfinished.addLast(i);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.unfinished.isEmpty()) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.unfinished.removeFirst();<br>        <span class="hljs-built_in">this</span>.finished.add(res);<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> &#123;<br>        <span class="hljs-keyword">return</span> !<span class="hljs-built_in">this</span>.finished.contains(number);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> &#123;   <br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.finished.contains(number)) &#123;<br>            <span class="hljs-built_in">this</span>.finished.remove(number);<br>            <span class="hljs-built_in">this</span>.unfinished.addLast(number);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/min-stack/">leetcode-155 最小栈</a></p>
<p>  <strong><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/bao-han-minhan-shu-de-zhan-lcof/">剑指 Offer 30. 包含min函数的栈</a></strong></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/peeking-iterator/">leetcode-284 顶端迭代器</a></p>
<p>  前置：<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/flatten-2d-vector/">leetcode-251 展开二维向量</a></p>
<p>  这里实际按照二维数组遍历的方法即可，只不过每次保留 i 和 j 的值，同时要考虑到这一行为空数组的情况（如果遇到了就直接跳过）</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector2D</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[][] vec;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> i, j;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Vector2D</span><span class="hljs-params">(<span class="hljs-type">int</span>[][] vec)</span> &#123;<br>        <span class="hljs-built_in">this</span>.vec = vec;<br>        <span class="hljs-built_in">this</span>.i = <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">this</span>.j = <span class="hljs-number">0</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (!hasNext()) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> vec[<span class="hljs-built_in">this</span>.i][<span class="hljs-built_in">this</span>.j];<br>        <span class="hljs-built_in">this</span>.j++;<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 可能存在空数组行 </span><br>        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">this</span>.i &lt; <span class="hljs-built_in">this</span>.vec.length &amp;&amp; <span class="hljs-built_in">this</span>.j == <span class="hljs-built_in">this</span>.vec[i].length) &#123;<br>            <span class="hljs-built_in">this</span>.j = <span class="hljs-number">0</span>;<br>            <span class="hljs-built_in">this</span>.i++;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.i == <span class="hljs-built_in">this</span>.vec.length) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>  因此对于顶端迭代器这道题，实际我也可以提前拿到下一个元素的值，然后作为一个成员变量时常更新即可</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PeekingIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span>&lt;Integer&gt; &#123;<br>	<span class="hljs-keyword">private</span> Iterator&lt;Integer&gt; iterator;<br><br>	<span class="hljs-keyword">private</span> Integer nextElm;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">PeekingIterator</span><span class="hljs-params">(Iterator&lt;Integer&gt; iterator)</span> &#123;<br>	    <span class="hljs-comment">// initialize any member here.</span><br>	    <span class="hljs-built_in">this</span>.iterator = iterator;<br>		<span class="hljs-built_in">this</span>.nextElm = <span class="hljs-built_in">this</span>.iterator.next();<br>	&#125;<br>	<br>    <span class="hljs-comment">// Returns the next element in the iteration without advancing the iterator.</span><br>	<span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">peek</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.nextElm;<br>	&#125;<br>	<br>	<span class="hljs-comment">// hasNext() and next() should behave the same as in the Iterator interface.</span><br>	<span class="hljs-comment">// Override them if needed.</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.nextElm;<br>	    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.iterator.hasNext()) &#123;<br>			<span class="hljs-built_in">this</span>.nextElm = <span class="hljs-built_in">this</span>.iterator.next();<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-built_in">this</span>.nextElm = <span class="hljs-literal">null</span>;<br>		&#125;<br><br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-keyword">return</span> !(nextElm == <span class="hljs-literal">null</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/04/25/ODDFUZZ%20Discovering%20Java%20Deserialization%20Vulnerabi%20969d466604e14480b464d5a0f649092d/">← 下一篇 《ODDFUZZ Discovering Java Deserialization Vulnerabilities via Structure-Aware Directed Greybox Fuzzing》论文笔记</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/04/10/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97%E7%AF%87%2048420399d0014e07ac9760f1e579f6d8/">算法提升——栈和队列篇 上一篇 →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">RacerZ</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/RacerZ-fighting"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" href="qiyizhang2002@foxmail.com"><i class="fa fa-envelope" alt="E-Mail"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0-%E5%93%88%E5%B8%8C%E7%AF%87"><span class="toc-number">1.</span> <span class="toc-text">数据结构复习-哈希篇</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>